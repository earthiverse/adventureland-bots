window.bots=function(t){var e={};function r(n){if(e[n])return e[n].exports;var a=e[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=9)}([function(t,e,r){"use strict";r.d(e,"r",(function(){return a})),r.d(e,"p",(function(){return i})),r.d(e,"j",(function(){return o})),r.d(e,"c",(function(){return s})),r.d(e,"d",(function(){return c})),r.d(e,"e",(function(){return p})),r.d(e,"b",(function(){return h})),r.d(e,"f",(function(){return l})),r.d(e,"o",(function(){return u})),r.d(e,"k",(function(){return m})),r.d(e,"h",(function(){return f})),r.d(e,"g",(function(){return g})),r.d(e,"n",(function(){return d})),r.d(e,"i",(function(){return y})),r.d(e,"m",(function(){return b})),r.d(e,"q",(function(){return _})),r.d(e,"l",(function(){return k})),r.d(e,"a",(function(){return x}));var n=function(t,e,r,n){return new(r||(r=Promise))((function(a,i){function o(t){try{c(n.next(t))}catch(t){i(t)}}function s(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,s)}c((n=n.apply(t,e||[])).next())}))};function a(t){return new Promise(e=>setTimeout(e,t))}function i(t){return"character"==t.type&&!function(t){return!!t.npc}(t)}function o(t=parent.character.items){const e=[];for(let r=0;r<42;r++)t[r]&&e.push(Object.assign(Object.assign({},t[r]),{index:r}));return e}function s(t){for(let e=0;e<42;e++)if(parent.character.items[e]&&parent.character.items[e].name==t)return Object.assign(Object.assign({},parent.character.items[e]),{index:e})}function c(t){const e=[];for(let r=0;r<42;r++)parent.character.items[r]&&parent.character.items[r].name==t&&e.push(Object.assign(Object.assign({},parent.character.items[r]),{index:r}));return e}function p(t,e){const r=[];for(let n=0;n<42;n++)parent.character.items[n]&&parent.character.items[n].name==t&&parent.character.items[n].level==e&&r.push(Object.assign(Object.assign({},parent.character.items[n]),{index:n}));return r}function h(t,e){let r=t.attack;return t.apiercing||(t.apiercing=0),t.rpiercing||(t.rpiercing=0),e.armor||(e.armor=0),!t.damage_type&&t.slots.mainhand&&(t.damage_type=G.items[t.slots.mainhand.name].damage),e["1hp"]?[1,1]:("physical"==t.damage_type?r*=damage_multiplier(e.armor-t.apiercing):"magical"==t.damage_type&&(r*=damage_multiplier(e.resistance-t.rpiercing)),[.9*r,1.1*r])}function l(t,e=!1){if(parent.next_skill&&parent.next_skill[t]){const r=parent.next_skill[t].getTime()-Date.now();return e?r+1:r<parent.character.ping?parent.character.ping:r+1}return parent.character.ping}function u(t=parent.character.items){for(let e=0;e<t.length;e++)if(!t[e])return!1;return!0}function m(){const t=new Set;for(const e of parent.party_list)t.add(parent.party[e].type);return t}function f(t=parent.character.items){const e=[];for(let r=0;r<t.length;r++)t[r]||e.push(r);return e}function g(){if("bank"!=parent.character.map)return;const t=[];for(const e in parent.character.bank)if("gold"!=e)for(let r=0;r<42;r++){parent.character.bank[e][r]||t.push({pack:e,index:r})}return t}function d(t){const e=G.skills[t].level;if(e&&e>parent.character.level)return!1;if(parent.character.stoned)return!1;if(parent.character.rip)return!1;const r=G.skills[t].wtype;if(r&&r!=G.items[parent.character.slots.mainhand.name].wtype)return!1;if(G.skills[t].slot)for(const e of G.skills[t].slot)if(parent.character.slots[e[0]].name!=e[1])return!1;if(G.skills[t].class){let e=!1;for(const r of G.skills[t].class)if(r==parent.character.ctype){e=!0;break}if(!e)return!1}let n=0;if(G.skills[t].mp?n=G.skills[t].mp:["attack","heal"].includes(t)&&(n=parent.character.mp_cost),parent.character.mp<n)return!1;if(void 0===parent.next_skill[t])return!0;const a=G.skills[t].share;return a?!parent.next_skill[a]||Date.now()>=parent.next_skill[a].getTime():Date.now()>=parent.next_skill[t].getTime()}function y({canAttackUsWithoutMoving:t,canKillInOneHit:e,canMoveTo:r,isAttacking:n,isAttackingParty:a,isAttackingUs:i,isCtype:o,isMonster:s,isMonsterType:c,isMoving:p,isNPC:l,isPartyMember:u,isPlayer:m,isRIP:f,isWithinDistance:g}){const d=[],y=is_pvp();for(const b in parent.entities){const _=parent.entities[b],v=distance(parent.character,_);!0===t&&_.range>v||(!1===t&&_.range<=v||!0===e&&h(parent.character,_)[0]>_.hp||!1===e&&h(parent.character,_)[0]<=_.hp||(!0!==r||can_move_to(_.real_x,_.real_y))&&(!1===r&&can_move_to(_.real_x,_.real_y)||(!0!==n||"monster"!=_.type||_.target)&&(!1===n&&"monster"==_.type&&_.target||(!0!==n||"character"!=_.type||_.target)&&(!0!==a||"monster"!=_.type||parent.party_list.includes(_.target))&&(!1===a&&"monster"==_.type&&parent.party_list.includes(_.target)||(!0!==a||"character"!=_.type||y)&&(!0===a&&"character"==_.type&&parent.party_list.includes(b)||!0===a&&"Wizard"==parent.character.name||!0===i&&"monster"==_.type&&_.target!=parent.character.name||!1===i&&"monster"==_.type&&_.target==parent.character.name||(!0!==i||"character"!=_.type||y)&&(!0===i&&"character"==_.type&&parent.party_list.includes(b)||!0===i&&"Wizard"==parent.character.name||(void 0===o||_.ctype)&&(void 0!==o&&_.ctype!=o||!0===s&&"monster"!=_.type||!1===s&&"monster"==_.type||(void 0===c||_.mtype)&&(void 0===c||c.includes(_.mtype))&&(!0!==p||_.moving)&&(!1===p&&_.moving||!0===l&&"character"!=_.type||(!0!==l||"character"!=_.type||_.npc)&&(!0!==u||parent.party_list.includes(b))&&(!1===u&&parent.party_list.includes(b)||!0===m&&"character"!=_.type||!0===m&&_.npc||(!0!==f||_.rip)&&(!1===f&&_.rip||void 0!==g&&v>g||d.push(_)))))))))))}return d}function b(){const t=new Set;for(const e in parent.entities){const r=parent.entities[e];r.mtype&&t.add(r.mtype)}return t}function _(t,e){for(const r of t)send_cm(r,e)}function v(t){const e=[];for(const r in G.maps){const n=G.maps[r];if(!n.instance)for(const a of n.monsters||[])if(a.type==t)if(a.boundary)e.push({map:r,x:(a.boundary[0]+a.boundary[2])/2,y:(a.boundary[1]+a.boundary[3])/2});else if(a.boundaries)for(const t of a.boundaries)e.push({map:t[0],x:(t[1]+t[3])/2,y:(t[2]+t[4])/2})}return e}function k(t){const e=v(t);return e[Math.floor(Math.random()*e.length)]}function x(t,e=9,r=1){return n(this,void 0,void 0,(function*(){let n=!1;if(!G.maps[parent.character.map].npcs)return;for(const t of G.maps[parent.character.map].npcs)if("merchant"==G.npcs[t.id].role&&distance(parent.character,{x:t.position[0],y:t.position[1]})<350){n=!0;break}if(!n)return;let a=p(t,e);a.length>=r||(a=c(t),a.length<Math.min(2,r)&&(yield buy_with_gold(t,1)))}))}},function(t,e,r){"use strict";r.d(e,"h",(function(){return i})),r.d(e,"g",(function(){return o})),r.d(e,"d",(function(){return s})),r.d(e,"a",(function(){return c})),r.d(e,"j",(function(){return p})),r.d(e,"i",(function(){return h})),r.d(e,"e",(function(){return l})),r.d(e,"f",(function(){return u})),r.d(e,"b",(function(){return m})),r.d(e,"c",(function(){return f}));var n=r(0),a=function(t,e,r,n){return new(r||(r=Promise))((function(a,i){function o(t){try{c(n.next(t))}catch(t){i(t)}}function s(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,s)}c((n=n.apply(t,e||[])).next())}))};function i(t){if("bank"==parent.character.map)return;if(!Object(n.d)("computer").length){let t=!1;if(!G.maps[parent.character.map].npcs)return;for(const e of G.maps[parent.character.map].npcs.filter(t=>"merchant"==G.npcs[t.id].role))if(distance(parent.character,{x:e.position[0],y:e.position[1]})<350){t=!0;break}if(!t)return}const e=Object.keys(t);for(const r of Object(n.j)())if("shiny"!=r.p&&e.includes(r.name)){if(r.level&&r.level>t[r.name])continue;r.q?sell(r.index,r.q):sell(r.index,1)}}function o(){const t=Object(n.c)("stand0");t&&void 0===parent.character.standed&&parent.open_merchant(t.index)}function s(){void 0!==parent.character.standed&&parent.close_merchant()}function c(t){let e=!1;for(const t of parent.npcs)if("secondhands"==t.id&&distance(parent.character,{x:t.position[0],y:t.position[1]})<350){e=!0;break}if(!e)return;let r=0;parent.socket.once("secondhands",e=>{for(let n=0;n<e.length&&!(t.has(e[n].name)&&(parent.socket.emit("sbuy",{rid:e[n].rid}),r++,r>=5));n++);}),parent.socket.emit("secondhands")}function p(t,e){const r=parent.entities[t];if(!r)return;if(distance(parent.character,r)>400)return;const n=new Set(e);for(let e=0;e<parent.character.items.length;e++){const r=parent.character.items[e];r&&(n.has(r.name)?n.delete(r.name):r.q?send_item(t,e,r.q):send_item(t,e,1))}}function h(t,e=0){if(parent.character.gold<=e)return;const r=parent.entities[t];r&&(distance(parent.character,r)>400||send_gold(t,parent.character.gold-e))}function l(t){return a(this,void 0,void 0,(function*(){if("bank"!=parent.character.map){if(!Object(n.d)("computer").length){let t=!1;for(const e of parent.npcs)if("craftsman"==e.id&&distance(parent.character,{x:e.position[0],y:e.position[1]})<250){t=!0;break}if(!t)return}for(const e in t)if(!(parent.character.gold<G.dismantle[e].cost))for(let r=t[e];r>0;r--){const t=Object(n.e)(e,r);for(const e of t)parent.socket.emit("dismantle",{num:e.index}),yield Object(n.r)(parent.character.ping)}}}))}function u(t){if(parent.character.q.exchange)return;if("bank"==parent.character.map)return;const e=Object(n.d)("computer").length,r=[];for(const t of parent.npcs)t.position&&distance(parent.character,{x:t.position[0],y:t.position[1]})<250&&r.push(t.id);if(!r.length&&!e)return;const a={};for(const t of Object(n.j)()){const e=G.items[t.name],r=e.e;if(!r||r>t.q)continue;let n;if("quest"==e.type)n=e.quest?G.quests[e.quest].id:"exchange";else if("box"==e.type||"gem"==e.type||"misc"==e.type)n="exchange";else{if("lostearring"!=t.name||2!=t.level)continue;n="pwincess"}a[n]||(a[n]=[]),a[n].push(t)}for(const t in a){if(!r.includes(t)&&!e)continue;const n=a[t][0];return void exchange(n.index)}}function m(){return a(this,void 0,void 0,(function*(){if("bank"==parent.character.map)return;if(!Object(n.d)("computer").length){let t=!1;if(!G.maps[parent.character.map].npcs)return;for(const e of G.maps[parent.character.map].npcs.filter(t=>"fancypots"==t.id))if(distance(parent.character,{x:e.position[0],y:e.position[1]})<350){t=!0;break}if(!t)return}if(parent.character.gold<G.items.mpot1.g)return;const t={mpot1:9999,hpot1:9999};for(const e in t){const r=t[e],a=Object(n.d)(e).reduce((t,e)=>t+e.q,0);a<r&&(yield buy_with_gold(e,Math.min(r-a,parent.character.gold/G.items[e].g)))}}))}function f(){return a(this,void 0,void 0,(function*(){if("bank"==parent.character.map)return;if(!Object(n.d)("computer").length){let t=!1;if(!G.maps[parent.character.map].npcs)return;for(const e of G.maps[parent.character.map].npcs.filter(t=>"scrolls"==t.id))if(distance(parent.character,{x:e.position[0],y:e.position[1]})<350){t=!0;break}if(!t)return}if(parent.character.gold<G.items.scroll0.g)return;const t={scroll0:1e3,scroll1:100,scroll2:10,cscroll0:1e3,cscroll1:100,cscroll2:10};for(const e in t){const r=t[e],a=Object(n.d)(e).reduce((t,e)=>t+e.q,0),i=Math.min(r-a,Math.floor(parent.character.gold/G.items[e].g));a<r&&i>0&&(yield buy_with_gold(e,i))}}))}},function(t,e,r){"use strict";(function(t){var e=function(t,e){return t<e};function n(t){if(!(this instanceof n))return new n(t);this.array=[],this.size=0,this.compare=t||e}n.prototype.clone=function(){var t=new n(this.compare);t.size=this.size;for(var e=0;e<this.size;e++)t.array.push(this.array[e]);return t},n.prototype.add=function(t){var e,r,n=this.size;for(this.array[this.size]=t,this.size+=1;n>0&&(e=n-1>>1,r=this.array[e],this.compare(t,r));)this.array[n]=r,n=e;this.array[n]=t},n.prototype.heapify=function(t){var e;for(this.array=t,this.size=t.length,e=this.size>>1;e>=0;e--)this._percolateDown(e)},n.prototype._percolateUp=function(t,e){for(var r,n,a=this.array[t];t>0&&(r=t-1>>1,n=this.array[r],e||this.compare(a,n));)this.array[t]=n,t=r;this.array[t]=a},n.prototype._percolateDown=function(t){for(var e,r,n,a=this.size,i=this.size>>>1,o=this.array[t];t<i&&(r=(e=1+(t<<1))+1,n=this.array[e],r<a&&this.compare(this.array[r],n)&&(e=r,n=this.array[r]),this.compare(n,o));)this.array[t]=n,t=e;this.array[t]=o},n.prototype._removeAt=function(t){if(!(t>this.size-1||t<0))return this._percolateUp(t,!0),this.poll()},n.prototype.remove=function(t){for(var e=0;e<this.size;e++)if(!this.compare(this.array[e],t)&&!this.compare(t,this.array[e]))return this._removeAt(e),!0;return!1},n.prototype._batchRemove=function(t,e){var r=new Array(e||this.size),n=0;if("function"==typeof t&&this.size)for(var a=0;a<this.size&&n<r.length;)t(this.array[a])?(r[n]=this._removeAt(a),n++,a>>=1):a++;return r.length=n,r},n.prototype.removeOne=function(t){var e=this._batchRemove(t,1);return e.length>0?e[0]:void 0},n.prototype.removeMany=function(t,e){return this._batchRemove(t,e)},n.prototype.peek=function(){if(0!=this.size)return this.array[0]},n.prototype.poll=function(){if(0!=this.size){var t=this.array[0];return this.size>1?(this.array[0]=this.array[--this.size],this._percolateDown(0)):this.size-=1,t}},n.prototype.replaceTop=function(t){if(0!=this.size){var e=this.array[0];return this.array[0]=t,this._percolateDown(0),e}},n.prototype.trim=function(){this.array=this.array.slice(0,this.size)},n.prototype.isEmpty=function(){return 0===this.size},n.prototype.forEach=function(t){if(!this.isEmpty()&&"function"==typeof t)for(var e=0,r=this.clone();!r.isEmpty();)t(r.poll(),e++)},n.prototype.kSmallest=function(t){if(0==this.size)return[];var e=this.compare,r=this.array,a=new n((function(t,n){return e(r[t],r[n])}));t=Math.min(this.size,t);var i=new Array(t),o=0;for(a.add(0);o<t;){var s=a.poll();i[o++]=this.array[s];var c=1+(s<<1),p=c+1;c<this.size&&a.add(c),p<this.size&&a.add(p)}return i};r.c[r.s]===t&&function(){var t=new n((function(t,e){return t<e}));for(t.add(1),t.add(0),t.add(5),t.add(4),t.add(3);!t.isEmpty();)console.log(t.poll())}(),t.exports=n}).call(this,r(4)(t))},function(t,e,r){"use strict";r.d(e,"a",(function(){return h}));var n=r(2),a=r.n(n),i=r(0),o=r(1),s=function(t,e,r,n){return new(r||(r=Promise))((function(a,i){function o(t){try{c(n.next(t))}catch(t){i(t)}}function s(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,s)}c((n=n.apply(t,e||[])).next())}))};class c{constructor(){this.TOWN_MOVEMENT_COST=250,this.DOOR_TOLERANCE=38,this.TELEPORT_TOLERANCE=73,this.MOVE_TOLERANCE=1,this.TOWN_TOLERANCE=1,this.SLEEP_AFTER_MS=500,this.SLEEP_FOR_MS=50,this.FINISH_CHECK_DISTANCE=200,this.MOVEMENTS=[[[0,25],[0,5]],[[25,0],[5,0]],[[0,-25],[0,-5]],[[-25,0],[-5,0]]],this.USE_BLINK=!0,this.MOVE_ON_FAIL=!1,this.SHOW_MESSAGES=!1,this.MESSAGE_COLOR="#F7600E",this.doorCache=new Map}isMoving(){return null==this.finishedDate&&null!=this.startDate}wasCancelled(t){return!this.startDate||t<this.startDate}stop(){this.reset(),parent.character.c.town&&stop("town"),stop()}reset(){this.finishedDate=void 0,this.startDate=void 0}cleanPosition(t){const e=void 0!==t.real_x?t.real_x:t.x,r=void 0!==t.real_y?t.real_y:t.y;return{map:t.map,x:e,y:r,key:`${t.map}.${e}.${r}`,transportS:t.transportS,transportMap:t.transportMap,transportType:t.transportType}}positionToString(t){return`${t.map}.${t.x}.${t.y}`}stringToPosition(t){const e=t.split("."),r=e[0],n=Number.parseFloat(e[1]),a=Number.parseFloat(e[2]);return{map:r,x:n,real_x:n,y:a,real_y:a}}findDoorPath(t,e,r=new Set,n=new Set){if(r.add(t),t.map==e.map){const n=distance(t,e),a=[];for(const t of r)a.push(t);return a.push(e),[n,a]}const a=[...G.maps[t.map].doors];for(const e of G.maps[t.map].npcs)if("transporter"===e.id){for(const r in G.npcs.transporter.places)r!=t.map&&a.push([e.position[0],e.position[1],-1,-1,r,G.npcs.transporter.places[r]]);break}let i,o=Number.MAX_VALUE;for(const s of a){const a=s[4];if(n.has(a))continue;if(s[7]||s[8])continue;const c={map:t.map,x:s[0],y:s[1],key:`${t.map}.${s[0]}.${s[1]}`,transportS:s[5],transportMap:a,transportType:-1==s[3]?"teleport":"door"},p={map:a,x:G.maps[a].spawns[s[5]][0],y:G.maps[a].spawns[s[5]][1],key:`${a}.${G.maps[a].spawns[s[5]][0]}.${G.maps[a].spawns[s[5]][1]}`},h=new Set(n);h.add(a);const l=new Set(r);l.add(c);const u=distance(t,c)+50;if(o<u)continue;const[m,f]=this.findDoorPath(p,e,l,h);o>m+u&&(o=m+u,i=f)}return[o,i]}heuristic(t,e){return distance(t,e)}smoothPath(t){let e=[];e.push(t[0]);for(let r=0;r<t.length-1;r++){const n=t[r];if("town"==n.transportType){e.push(n);break}let a=r+1;for(let e=r+1;e<t.length;e++){const i=t[e];can_move({map:n.map,x:i.x,y:i.y,going_x:n.x,going_y:n.y,base:parent.character.base})&&(a=e,r=e-1)}a>0&&e.push(t[a])}return e=e.reverse(),e}reconstructPath(t,e,r){const n=[];for(n.push({map:e.map,x:e.x,real_x:e.x,y:e.y,real_y:e.y,key:`${e.map}.${e.x}.${e.y}`,transportMap:e.transportMap,transportType:e.transportType,transportS:e.transportS});t;)n.push({map:t.map,x:t.x,real_x:t.x,y:t.y,real_y:t.y,key:`${t.map}.${t.x}.${t.y}`,transportMap:t.transportMap,transportType:t.transportType,transportS:t.transportS}),t=r.get(t.key);return this.smoothPath(n)}smartMove(t,e=0){return s(this,void 0,void 0,(function*(){this.reset(),this.startDate=new Date;let r=[];const n=Date.now();this.SHOW_MESSAGES&&game_log("a* - start searching",this.MESSAGE_COLOR);const a=this.findDoorPath(this.cleanPosition(parent.character),this.cleanPosition(t))[1];for(let t=0;t<a.length;t+=2){const n=a[t],i=a[t+1],o=`${n.key}_${i.key}`;let s;this.doorCache.has(o)?s=this.doorCache.get(o):(s="door"==i.transportType?yield this.getMovements(n,i,this.DOOR_TOLERANCE):"teleport"==i.transportType?yield this.getMovements(n,i,this.TELEPORT_TOLERANCE):yield this.getMovements(n,i,e),this.doorCache.set(o,s)),r=r.concat(s)}this.SHOW_MESSAGES&&game_log(`a* - finish searching (${((Date.now()-n)/1e3).toFixed(1)} s)`,this.MESSAGE_COLOR);let i=0;const o=new Promise((t,e)=>{const n=a=>{if(this.wasCancelled(a))return stop(),e("a* - cancelled moving");const o=r[i];if(distance(parent.character,r[r.length-1])<this.MOVE_TOLERANCE)return this.SHOW_MESSAGES&&game_log("a* - done moving",this.MESSAGE_COLOR),this.finishedDate=new Date,void t();if(parent.character.moving||is_transporting(parent.character)||!can_walk(parent.character));else{if(o.map==parent.character.map&&this.USE_BLINK&&can_use("blink")&&distance(parent.character,o)>this.TOWN_MOVEMENT_COST&&parent.character.mp>G.skills.blink.mp){let t=i;for(;t<r.length&&r[t].map===parent.character.map;t++);return i=t-1,setTimeout(()=>{n(a)},900),void use_skill("blink",[r[i].x,r[i].y])}if(o.map==parent.character.map&&"town"==o.transportType)return distance(parent.character,o)<this.TOWN_TOLERANCE?(i+=1,void n(a)):(setTimeout(()=>{n(a)},900),void use_skill("town"));if(parent.character.map!=o.map||!can_move_to(o.x,o.y)){if(this.SHOW_MESSAGES&&game_log("a* - failed moving",this.MESSAGE_COLOR),this.MOVE_ON_FAIL){const t=2*Math.random()-1,e=2*Math.random()-1;move(parent.character.real_x+t,parent.character.real_y+e)}return this.reset(),e("failed moving")}if(distance(parent.character,o)<this.MOVE_TOLERANCE){if("door"!=o.transportType&&"teleport"!=o.transportType)return i+=1,void n(a);if(parent.character.map==o.map)return transport(o.transportMap,o.transportS),i+=1,void setTimeout(()=>{n(a)},100)}else move(o.x,o.y)}setTimeout(()=>{n(a)},40)};this.SHOW_MESSAGES&&game_log("a* - start moving",this.MESSAGE_COLOR),n(this.startDate)});return yield o}))}getMovements(t,e,r=0,n=this.startDate){return s(this,void 0,void 0,(function*(){const o=this.cleanPosition(t),s=this.cleanPosition(e),c=new Map,p=new Map;p.set(o.key,0);const h=new Map;h.set(o.key,this.heuristic(o,s));const l=new a.a((t,e)=>h.get(t.key)<h.get(e.key));l.add(Object.assign({},o));const u=new Set,m=this.cleanPosition({map:o.map,x:G.maps[o.map].spawns[0][0],y:G.maps[o.map].spawns[0][1],transportType:"town"}),f=p.get(o.key)+this.TOWN_MOVEMENT_COST;m.key!==o.key&&(!p.get(m.key)||f<p.get(m.key))&&(c.set(m.key,o),p.set(m.key,f),h.set(m.key,f+this.heuristic(m,s)),u.has(m.key)||(u.add(m.key),l.add(m)));let g=Date.now();for(;l.size;){const t=l.poll();u.delete(t.key);const e=distance(t,s);if(e<r){const e=this.reconstructPath(t,Object.assign(Object.assign({},t),{transportType:s.transportType,transportMap:s.transportMap,transportS:s.transportS}),c);return Promise.resolve(e)}if(e<r+this.FINISH_CHECK_DISTANCE)if(0==r){if(can_move({map:t.map,x:t.x,y:t.y,going_x:s.x,going_y:s.y,base:parent.character.base})){const e=this.reconstructPath(t,s,c);return Promise.resolve(e)}}else{const e=Math.atan2(t.y-s.y,t.x-s.x),n=s.x+Math.cos(e)*r,a=s.y+Math.sin(e)*r,i={map:s.map,x:n,y:a,key:this.positionToString({x:n,y:a,map:s.map}),transportMap:s.transportMap,transportType:s.transportType,transportS:s.transportS};if(can_move({map:t.map,x:t.x,y:t.y,going_x:i.x,going_y:i.y,base:parent.character.base})){const e=this.reconstructPath(t,i,c);return Promise.resolve(e)}}for(const e of this.MOVEMENTS)for(const r of e){const e=this.cleanPosition({map:t.map,x:Math.trunc(t.x+r[0]),y:Math.trunc(t.y+r[1])});if(can_move({map:t.map,x:t.x,y:t.y,going_x:e.x,going_y:e.y,base:parent.character.base})){const n=p.get(t.key)+Math.abs(r[0])+Math.abs(r[1]);(!p.has(e.key)||n<p.get(e.key))&&(c.set(e.key,t),p.set(e.key,n),h.set(e.key,n+this.heuristic(e,s)),u.has(e.key)||(u.add(e.key),l.add(e)))}}if(Date.now()-g>this.SLEEP_AFTER_MS&&(yield Object(i.r)(this.SLEEP_FOR_MS),g=Date.now(),this.wasCancelled(n)))return Promise.reject("cancelled")}this.SHOW_MESSAGES&&game_log("a* - failed searching",this.MESSAGE_COLOR);try{let t,e=Number.MAX_VALUE;for(const[r,n]of h){const a=p.get(r);n-a<e&&(e=n-a,t=r)}const r=this.stringToPosition(t),n=this.reconstructPath(r,s,c);return Promise.resolve(n)}catch(t){return Promise.reject("Failed to find a path...")}}))}}var p=function(t,e,r,n){return new(r||(r=Promise))((function(a,i){function o(t){try{c(n.next(t))}catch(t){i(t)}}function s(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,s)}c((n=n.apply(t,e||[])).next())}))};class h{constructor(){this.astar=new c,this.itemsToKeep=["computer","tracker","goldbooster","luckbooster","xpbooster","hpot1","mpot1","hotchocolate","candypop","jacko","lantern"],this.itemsToSell={shoes:2,pants:2,coat:2,helmet:2,gloves:2,cclaw:2,hpamulet:1,hpbelt:1,maceofthedead:2,ringsj:1,slimestaff:2,spear:2,throwingstars:2,vitearring:1,vitring:1},this.itemsToDismantle={},this.itemsToExchange=new Set(["5bucks","gem0","gem1","seashell","leather","candycane","mistletoe","ornament","candy0","candy1","redenvelopev3","basketofeggs","armorbox","bugbountybox","gift0","gift1","mysterybox","weaponbox","xbox"]),this.itemsToBuy=new Set([...this.itemsToExchange,"dexbelt","intbelt","strbelt","ctristone","dexring","intring","ringofluck","strring","suckerpunch","tristone","dexearring","intearring","lostearring","strearring","dexamulet","intamulet","stramulet","t2dexamulet","t2intamulet","t2stramulet","charmer","ftrinket","jacko","orbg","orbofdex","orbofint","orbofsc","orbofstr","rabbitsfoot","talkingskull","t2quiver","lantern","mshield","quiver","xshield","angelwings","bcape","cape","ecape","stealthcape","mrnboots","mwboots","xboots","mrnpants","mwpants","starkillers","xpants","cdragon","mrnarmor","mwarmor","xarmor","eears","fury","mrnhat","mwhelmet","partyhat","rednose","xhelmet","goldenpowerglove","handofmidas","mrngloves","mwgloves","poker","powerglove","xgloves","basher","bowofthedead","candycanesword","carrotsword","dartgun","firebow","gbow","harbringer","hbow","merry","oozingterror","ornamentstaff","pmace","t2bow","t3bow","ascale","bfur","cscale","fireblade","goldenegg","goldingot","goldnugget","leather","networkcard","platinumingot","platinumnugget","pleather","snakefang","x0","x1","x2","x3","x4","x5","x6","x7","x8","egg0","egg1","egg2","egg3","egg4","egg5","egg6","egg7","egg8","essenceofether","essenceoffire","essenceoffrost","essenceoflife","essenceofnature","bunnyelixir","candypop","elixirdex0","elixirdex1","elixirdex2","elixirint0","elixirint1","elixirint2","elixirluck","elixirstr0","elixirstr1","elixirstr2","greenbomb","hotchocolate","bottleofxp","bugbountybox","monstertoken","poison"]),this.holdPosition=!1,this.holdAttack=!1,this.info={party:{},npcs:{},players:{},monsters:{}}}mainLoop(){return p(this,void 0,void 0,(function*(){try{if("merchant"!=parent.character.ctype&&(this.equipBetterItems(),this.getMonsterhuntQuest(),yield Object(o.b)()),this.getNewYearTreeBuff(),Object(o.e)(this.itemsToDismantle),null==parent.character.slots.elixir){const t=Object(i.d)("candypop");t.length&&equip(t[0].index)}for(const t of Object(i.i)({isCtype:"merchant",isWithinDistance:400}))for(const e in t.slots){const r=t.slots[e];r&&(r.giveaway&&(r.list.includes(parent.character.id)||parent.socket.emit("join_giveaway",{slot:e,id:t.id,rid:r.rid})))}for(const t of Object(i.i)({isCtype:"merchant",isWithinDistance:400}))for(const e in t.slots){const r=t.slots[e];if(r&&(!r.b&&r.rid&&this.itemsToBuy.has(r.name)&&!(r.price>2*G.items[r.name].g||parent.character.gold<r.price)))if(r.q){const n=Math.min(r.q,Math.floor(parent.character.gold/r.price));parent.socket.emit("trade_buy",{slot:e,id:t.id,rid:r.rid,q:n})}else parent.socket.emit("trade_buy",{slot:e,id:t.id,rid:r.rid,q:1})}this.loot()}catch(t){console.error(t)}setTimeout(()=>{this.mainLoop()},Math.max(250,parent.character.ping))}))}run(){this.healLoop(),this.attackLoop(),this.scareLoop(),this.moveLoop(),this.sendInfoLoop(),this.mainLoop()}sendInfoLoop(){try{let t;t={message:"info",info:{lastSeen:new Date,shouldSwitchServer:this.shouldSwitchServer(),monsterHuntTargets:this.getMonsterHuntTargets(),items:Object(i.j)(),attack:parent.character.attack,frequency:parent.character.frequency,goldm:parent.character.goldm,last_ms:parent.character.last_ms,luckm:parent.character.luckm,map:parent.character.map,x:parent.character.real_x,y:parent.character.real_y,s:parent.character.s}},Object(i.q)(parent.party_list,t),this.parseCM(parent.character.name,t);for(const e of Object(i.i)({isPlayer:!0}))t={message:"player",id:e.id,info:{lastSeen:new Date,rip:e.rip,map:e.map,x:e.real_x,y:e.real_y,s:e.s,ctype:e.ctype}},Object(i.q)(parent.party_list,t),this.parseCM(parent.character.name,t);for(const e of["Angel","Kane"])parent.entities[e]&&(t={message:"npc",id:e,info:{lastSeen:new Date,map:parent.entities[e].map,x:parent.entities[e].real_x,y:parent.entities[e].real_y}},parent.entities[e]&&(Object(i.q)(parent.party_list,t),this.parseCM(parent.character.name,t)))}catch(t){console.error(t)}setTimeout(()=>{this.sendInfoLoop()},5e3)}getMonsterHuntTargets(){const t=[];let e=Number.MAX_VALUE;for(const r of parent.party_list){const n=this.info.party[r];if(!n)continue;if(!n.s.monsterhunt||0==n.s.monsterhunt.c)continue;if(!this.targetPriority[n.s.monsterhunt.id])continue;const a=this.targetPriority[n.s.monsterhunt.id].coop;if(a){const t=Object(i.k)();if(a.filter(e=>!t.has(e)).length)continue}const o=n.s.monsterhunt.ms-(Date.now()-new Date(n.last_ms).getTime());o<e?(e=o,t.unshift(n.s.monsterhunt.id)):t.push(n.s.monsterhunt.id)}return t}shouldSwitchServer(){if("merchant"==parent.character.ctype)return!0;if(!parent.character.s.monsterhunt)return!1;if(0==parent.character.s.monsterhunt.c)return!1;if(this.getMonsterHuntTargets().length)return!1;for(const t in parent.S)if("grinch"!=t&&!(parent.S[t].hp/parent.S[t].max_hp>.9)&&parent.S[t].live&&this.targetPriority[t])return!1;return!0}loot(){let t=0;for(const e in parent.chests){const r=parent.chests[e];if(distance(parent.character,r)>800)continue;let n=!0;for(const t of parent.party_list){if(t==parent.character.id)continue;const e=parent.entities[t];if(e&&(!(distance(e,r)>800)&&this.info.party[t])){if(["chest3","chest4"].includes(r.skin)){if(parent.character.goldm>=this.info.party[t].goldm)continue}else if(parent.character.luckm>=this.info.party[t].luckm)continue;n=!1;break}}if(n&&(parent.socket.emit("open_chest",{id:e}),++t>10))break}}attackLoop(){return p(this,void 0,void 0,(function*(){try{const t=this.getTargets(1);t.length&&this.wantToAttack(t[0])&&(yield attack(t[0]),reduce_cooldown("attack",Math.min(...parent.pings)))}catch(t){return"cooldown"==t.reason?void setTimeout(()=>{this.attackLoop()},Math.min(...parent.pings)-t.remaining):(["not_found","disabled"].includes(t.reason)||console.error(t),void setTimeout(()=>{this.attackLoop()},Object(i.f)("attack")))}setTimeout(()=>{this.attackLoop()},Object(i.f)("attack",!0))}))}scareLoop(){try{const t=Object(i.i)({isAttackingUs:!0,isMonster:!0,isRIP:!1});let e=!1;if(t.length>=3)e=!0;else if(t.length&&!this.targetPriority[t[0].mtype])e=!0;else if(parent.character.c.town&&(t.length>1||1==t.length&&distance(t[0],parent.character)-t[0].range-2*t[0].speed))e=!0;else for(const r of t)if(!(distance(r,parent.character)>r.range||6*Object(i.b)(r,parent.character)[1]*r.frequency<=parent.character.hp)){e=!0;break}if(!Object(i.n)("scare")||!e)return void setTimeout(()=>{this.scareLoop()},Object(i.f)("scare"));if("jacko"==parent.character.slots.orb.name)use_skill("scare"),reduce_cooldown("scare",Math.min(...parent.pings));else{const t=Object(i.d)("jacko");if(t.length){const e=t[0].index;equip(e),use_skill("scare"),reduce_cooldown("scare",Math.min(...parent.pings))}}}catch(t){console.error(t)}setTimeout(()=>{this.scareLoop()},Object(i.f)("scare"))}getMovementLocation(t){if(!this.targetPriority[t])return;if(this.targetPriority[t].farmingPosition&&this.targetPriority[t].holdPositionFarm)return this.targetPriority[t].farmingPosition;if(Object(i.m)().has(t))return;if(this.targetPriority[t].farmingPosition)return distance(parent.character,this.targetPriority[t].farmingPosition)<300?void 0:this.targetPriority[t].farmingPosition;if(parent.S[t]){if(!parent.S[t].live)return;return parent.S[t]}const e=Object(i.l)(t);return e||void 0}getMovementTarget(){if(parent.character.rip)return void set_message("RIP");if(parent.character.s.monsterhunt&&0==parent.character.s.monsterhunt.c)return set_message("Finish MH"),{target:"monsterhunter",position:G.maps.main.ref.monsterhunter,range:300};for(const t of Object(i.i)({isMonster:!0,isRIP:!1}))if(("goldenbat"==t.mtype||"phoenix"==t.mtype)&&this.targetPriority[t.mtype])return set_message(t.mtype),{target:t.mtype,position:t,range:parent.character.range};for(const t in this.info.monsters){if(!this.targetPriority[t])continue;const e=this.info.monsters[t],r=parent.entities[e.id];if(r&&(e.x=r.real_x,e.y=r.real_y),!(distance(parent.character,e)<100)||r)return set_message("SP "+t),{target:t,position:e,range:0};delete this.info.monsters[t]}if(G.maps.main.ref.newyear_tree&&!parent.character.s.holidayspirit)return set_message("Xmas Tree"),{target:"newyear_tree",position:G.maps.main.ref.newyear_tree,range:300};if(Object(i.o)())return set_message("Full!"),{target:"merchant",position:{map:"main",x:60,y:-325},range:300};for(const t in parent.S)if(parent.S[t].live&&this.targetPriority[t])return set_message(t),{target:t,position:parent.S[t],range:parent.character.range};const t=this.getMonsterHuntTargets();if(t.length){const e=t[0],r=this.targetPriority[e].coop;if(!r)return set_message("MH "+e),{target:e,position:this.getMovementLocation(e)};{const t=new Set;for(const r of parent.party_list)this.info.party[r]&&this.info.party[r].monsterHuntTargets&&this.info.party[r].monsterHuntTargets[0]==e&&t.add(parent.party[r].type);if(0==r.filter(e=>!t.has(e)).length)return set_message("MH "+e),{target:e,position:this.getMovementLocation(e)}}}return parent.character.s.monsterhunt?this.mainTarget?(set_message(this.mainTarget),{target:this.mainTarget,position:this.getMovementLocation(this.mainTarget)}):void 0:(set_message("New MH"),{target:"monsterhunter",position:G.maps.main.ref.monsterhunter,range:300})}moveLoop(){try{if(this.holdPosition||smart.moving)return void setTimeout(()=>{this.moveLoop()},parent.character.ping);const t=this.movementTarget;if(this.movementTarget=this.getMovementTarget(),this.movementTarget&&this.movementTarget.position){if(!t||this.movementTarget.target!=t.target||t.position&&this.movementTarget.position.map!=t.position.map)return this.astar.stop(),this.astar.smartMove(this.movementTarget.position,this.movementTarget.range),void setTimeout(()=>{this.moveLoop()},parent.character.ping);if(!this.astar.isMoving())return this.astar.smartMove(this.movementTarget.position,this.movementTarget.range),void setTimeout(()=>{this.moveLoop()},parent.character.ping)}const e=this.getTargets(1);if(e.length&&e[0].mtype==this.movementTarget.target&&this.targetPriority[e[0].mtype]&&!this.targetPriority[e[0].mtype].holdPositionFarm&&this.astar.stop(),this.targetPriority[this.movementTarget.target]&&this.targetPriority[this.movementTarget.target].holdPositionFarm)return void setTimeout(()=>{this.moveLoop()},parent.character.ping);const r=[],n=[],a=[],o=[],s=[],c=[],p=[],h=[];for(const t in parent.entities){const e=parent.entities[t];if(e.rip)continue;if(!this.targetPriority[e.mtype])continue;const l=distance(parent.character,e),u=Math.max(e.range+e.speed,50);u<parent.character.range&&l<u&&(e.hp>Object(i.b)(parent.character,e)[0]||e.target==parent.character.name)&&r.push(e),!e.target&&l<50&&n.push(e),l<parent.character.range?(a.push(e),this.movementTarget.target==e.mtype&&o.push(e)):l<2*parent.character.range&&(s.push(e),this.movementTarget.target==e.mtype&&c.push(e)),p.push(e),this.movementTarget.target==e.mtype&&h.push(e)}if(0==o.length&&h.length>0){let t,e=Number.MAX_VALUE;for(const r of h){const n=distance(parent.character,r);n<e&&(e=n,t=r)}return this.astar.smartMove(t,parent.character.range),void setTimeout(()=>{this.moveLoop()},parent.character.ping)}if(r.length){const t={x:0,y:0};let e=0;for(const n of r)t.x+=n.real_x,t.y+=n.real_y,n.range+n.speed>e&&(e=n.range+n.speed);t.x/=r.length,t.y/=r.length;const n=Math.atan2(parent.character.real_y-t.y,parent.character.real_x-t.x),a=Math.min(parent.character.range,1.5*e),i=(t,e)=>{const r=Math.cos(t)*e,n=Math.sin(t)*e;return{x:parent.character.real_x+r,y:parent.character.real_y+n}};let o=i(n,a),s=0;for(;!can_move_to(o.x,o.y)&&s<180;)s=s<=0?1-s:-s,o=i(n+s*Math.PI/180,a);return move(o.x,o.y),void setTimeout(()=>{this.moveLoop()},parent.character.ping)}if(s.length){let t,e=Number.MAX_VALUE;for(const r of s){const n=distance(parent.character,r);n<e&&(e=n,t=r)}return this.astar.smartMove(t,parent.character.range),void setTimeout(()=>{this.moveLoop()},parent.character.ping)}if(p.length){let t,e=Number.MAX_VALUE;for(const r of p){const n=distance(parent.character,r);n<e&&(e=n,t=r)}return this.astar.smartMove(t,parent.character.range),void setTimeout(()=>{this.moveLoop()},parent.character.ping)}}catch(t){console.error(t)}setTimeout(()=>{this.moveLoop()},parent.character.ping)}healLoop(){return p(this,void 0,void 0,(function*(){try{if(parent.character.rip)return respawn(),void setTimeout(()=>{this.healLoop()},Object(i.f)("use_town"));if(!Object(i.n)("use_hp"))return void setTimeout(()=>{this.healLoop()},Object(i.f)("use_hp"));const t=["hpot0","hpot1"],e=["mpot0","mpot1"];let r=null,n=null;for(let a=parent.character.items.length-1;a>=0;a--){const i=parent.character.items[a];if(i&&(!n&&t.includes(i.name)?n=i:!r&&e.includes(i.name)&&(r=i),n&&r))break}const a=parent.character.hp/parent.character.max_hp,o=parent.character.mp/parent.character.max_mp;a<=o&&1!=a&&(!n||"hpot0"==n.name&&(parent.character.hp<=parent.character.max_hp-200||parent.character.hp<50)||"hpot1"==n.name&&(parent.character.hp<=parent.character.max_hp-400||parent.character.hp<50))?(use_skill("use_hp"),reduce_cooldown("use_hp",Math.min(...parent.pings)),reduce_cooldown("use_mp",Math.min(...parent.pings))):1!=o&&(!r||"mpot0"==r.name&&(parent.character.mp<=parent.character.max_mp-300||parent.character.mp<50)||"mpot1"==r.name&&(parent.character.mp<=parent.character.max_mp-500||parent.character.mp<50))?(use_skill("use_mp"),reduce_cooldown("use_hp",Math.min(...parent.pings)),reduce_cooldown("use_mp",Math.min(...parent.pings))):a<o?(parent.socket.emit("use",{item:"hp"}),reduce_cooldown("use_hp",Math.min(...parent.pings)),reduce_cooldown("use_mp",Math.min(...parent.pings))):o<a&&(parent.socket.emit("use",{item:"mp"}),reduce_cooldown("use_hp",Math.min(...parent.pings)),reduce_cooldown("use_mp",Math.min(...parent.pings)))}catch(t){console.error(t)}setTimeout(()=>{this.healLoop()},Object(i.f)("use_hp"))}))}getNewYearTreeBuff(){G.maps.main.ref.newyear_tree&&(parent.character.s.holidayspirit||distance(parent.character,G.maps.main.ref.newyear_tree)>400||parent.socket.emit("interaction",{type:"newyear_tree"}))}getMonsterhuntQuest(){distance(parent.character,G.maps.main.ref.monsterhunter)>400||(parent.character.s.monsterhunt?0==parent.character.s.monsterhunt.c&&parent.socket.emit("monsterhunt"):parent.socket.emit("monsterhunt"))}parseCM(t,e){if(parent.party_list.includes(t)||parent.character.name==t||["earthiverse","earthMag","earthMag2"].includes(t)||"monster"==e.message){if("info"==e.message)this.info.party[t]=e.info;else if("monster"==e.message)this.info.monsters[e.id]=e.info;else if("npc"==e.message)this.info.npcs[e.id]=e.info;else if("player"==e.message)this.info.players[e.id]=e.info;else if("chests"==e.message)for(const t in e.chests)parent.chests[t]||(parent.chests[t]=e.chests[t])}else game_log("Blocked CM from "+t)}equipBetterItems(){try{const t=Object(i.j)();if(this.movementTarget.target&&this.targetPriority[this.movementTarget.target])for(const e of this.targetPriority[this.movementTarget.target].equip||[]){let r=!1;for(const t in parent.character.slots){const n=parent.character.slots[t];if(n&&n.name==e){r=!0;break}}if(!r)for(const r of t)if(r.name==e){G.classes[parent.character.ctype].doublehand[G.items[e].wtype]&&unequip("offhand"),equip(r.index);break}}for(const e in parent.character.slots){let r,n=parent.character.slots[e];if(n){for(const e of t)e.name==n.name&&(!e.level||e.level<=n.level||(n=e,r=e));r&&equip(r.index,e)}}}catch(t){console.error(t)}}getTargets(t=1,e=parent.character.range){const r=[],n=parent.party_list,o=new Set;for(const t in parent.entities)if(n.includes(t)){const e=parent.entities[t].target;e&&o.add(e)}const s=new a.a((t,e)=>t.priority>e.priority);for(const t in parent.entities){const r=parent.entities[t];if(r.rip)continue;if(parent.party_list.includes(t))continue;if(!is_pvp()&&"monster"!=r.type)continue;if(is_pvp()&&parent.party_list.includes(t))continue;if(!this.targetPriority[r.mtype]&&r.target!=parent.character.name)continue;let n=this.targetPriority[r.mtype]?this.targetPriority[r.mtype].priority:0;const a=distance(parent.character,r);if(a>e)continue;n-=a,o.has(t)&&(this.targetPriority[r.mtype]&&this.targetPriority[r.mtype].coop&&(n+=parent.character.range),r.hp<=Object(i.b)(parent.character,r)[0]&&(n-=parent.character.range)),r.mtype==this.mainTarget&&(n+=250),this.movementTarget&&r.mtype==this.movementTarget.target&&(n+=1e3),r.target==parent.character.name&&(n+=2e3),r.cooperative&&(n+=1e3*(r.max_hp-r.hp)/r.max_hp);const c={id:r.id,priority:n};s.add(c)}for(;r.length<t&&s.size>0;){const t=parent.entities[s.poll().id];t&&r.push(t)}return r.length>0&&change_target(r[0],!0),r}wantToAttack(t,e="attack"){if(!Object(i.n)(e))return!1;if(parent.character.c.town)return!1;let r=G.skills[e].range?G.skills[e].range:parent.character.range;const n=distance(parent.character,t);if(G.skills[e].range_multiplier&&(r*=G.skills[e].range_multiplier),n>r)return!1;const a=G.skills[e].mp?G.skills[e].mp:parent.character.mp_cost;if(parent.character.mp<a)return!1;if("attack"!=e&&t.immune)return!1;if("attack"!=e&&t["1hp"])return!1;if(!is_pvp()&&"monster"==t.type&&!this.targetPriority[t.mtype])return!1;if(!t.target){if(this.holdAttack)return!1;if((smart.moving||this.astar.isMoving())&&this.targetPriority[t.mtype].holdAttackWhileMoving)return!1;if(this.targetPriority[t.mtype].holdAttackInEntityRange&&n<=t.range)return!1;if(this.targetPriority[t.mtype].coop){const e=[parent.character.ctype];for(const t of parent.party_list){const r=parent.entities[t];r&&(r.rip||"priest"==r.ctype&&distance(parent.character,r)>r.range||e.push(r.ctype))}for(const r of this.targetPriority[t.mtype].coop)if(!e.includes(r))return!1}if(5*Object(i.b)(t,parent.character)[1]*t.frequency>parent.character.hp&&n<=t.range)return!1}return!0}}},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},,,,,function(t,e,r){"use strict";r.r(e),r.d(e,"warrior",(function(){return c}));var n=r(3),a=r(1),i=r(0),o=function(t,e,r,n){return new(r||(r=Promise))((function(a,i){function o(t){try{c(n.next(t))}catch(t){i(t)}}function s(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,s)}c((n=n.apply(t,e||[])).next())}))};class s extends n.a{constructor(){super(),this.targetPriority={arcticbee:{priority:30,equip:["basher"]},bat:{priority:30,farmingPosition:{map:"cave",x:1250,y:-800},equip:["basher"]},bbpompom:{coop:["priest"],holdPositionFarm:!0,holdAttackWhileMoving:!0,priority:10,farmingPosition:{map:"winter_cave",x:0,y:-100},equip:["basher"]},bee:{priority:30,equip:["bataxe"]},boar:{coop:["warrior","priest"],priority:10,holdAttackWhileMoving:!0,holdPositionFarm:!0,farmingPosition:{map:"winterland",x:0,y:-850},equip:["basher"]},crab:{priority:30,equip:["bataxe"]},crabx:{priority:20,equip:["basher"]},croc:{priority:30,equip:["basher"]},fireroamer:{coop:["priest"],priority:0,holdPositionFarm:!0,holdAttackWhileMoving:!0,farmingPosition:{map:"desertland",x:200,y:-700},equip:["basher"]},fvampire:{coop:["priest","ranger"],priority:0,holdPositionFarm:!0,holdAttackWhileMoving:!0,farmingPosition:{map:"halloween",x:-150,y:-1575},equip:["basher"]},ghost:{coop:["priest"],priority:0,holdAttackWhileMoving:!0,holdPositionFarm:!0,farmingPosition:{map:"halloween",x:400,y:-1100},equip:["basher"]},goldenbat:{priority:500,equip:["basher"]},goo:{priority:30,equip:["bataxe"]},greenjr:{priority:10,holdAttackInEntityRange:!0,holdAttackWhileMoving:!0,equip:["basher"]},iceroamer:{priority:10,equip:["basher"]},mechagnome:{coop:["priest","ranger"],holdPositionFarm:!0,holdAttackWhileMoving:!0,priority:10,farmingPosition:{map:"cyberland",x:150,y:-100},equip:["basher"]},minimush:{priority:30,equip:["bataxe"]},mole:{coop:["priest","warrior"],holdPositionFarm:!0,holdAttackWhileMoving:!0,priority:10,farmingPosition:{map:"tunnel",x:0,y:-75},equip:["basher"]},mummy:{coop:["priest"],priority:10,holdPositionFarm:!0,holdAttackWhileMoving:!0,farmingPosition:{map:"spookytown",x:255,y:-1125},equip:["basher"]},oneeye:{coop:["ranger","priest"],priority:0,holdAttackWhileMoving:!0,holdPositionFarm:!0,farmingPosition:{map:"level2w",x:-150,y:0},equip:["basher"]},osnake:{priority:30,equip:["bataxe"]},phoenix:{priority:500,equip:["basher"]},pinkgoblin:{priority:100,holdAttackWhileMoving:!0,coop:["priest","ranger"],equip:["basher"]},pinkgoo:{priority:1e3,equip:["candycanesword","woodensword"]},poisio:{priority:20,equip:["basher"]},rat:{priority:30,equip:["basher"]},scorpion:{priority:20,equip:["basher"]},snake:{priority:30,farmingPosition:{map:"main",x:-74,y:1904},equip:["bataxe"]},snowman:{priority:500,equip:["candycanesword","woodensword"]},spider:{priority:20,equip:["basher"]},squig:{priority:30,equip:["bataxe"]},squigtoad:{priority:30},tortoise:{priority:30,equip:["basher"]},wolf:{coop:["priest"],priority:0,holdPositionFarm:!0,holdAttackWhileMoving:!0,farmingPosition:{map:"winterland",x:450,y:-2500},equip:["basher"]},wolfie:{coop:["warrior","priest"],priority:10,holdAttackWhileMoving:!0,holdPositionFarm:!0,farmingPosition:{map:"winterland",x:0,y:-1825},equip:["basher"]}},this.mainTarget="scorpion",this.itemsToKeep.push("basher","bataxe","candycanesword","carrotsword","fireblade","fsword","wblade","woodensword","mshield","shield","sshield","xshield")}run(){super.run(),this.agitateLoop(),this.chargeLoop(),this.hardshellLoop(),this.cleaveLoop(),this.stompLoop(),this.warcryLoop(),this.tauntLoop()}mainLoop(){const t=Object.create(null,{mainLoop:{get:()=>super.mainLoop}});return o(this,void 0,void 0,(function*(){try{Object(a.j)("earthMer",this.itemsToKeep),Object(a.i)("earthMer",1e5),Object(a.h)(this.itemsToSell),t.mainLoop.call(this)}catch(t){console.error(t),setTimeout(()=>{this.mainLoop()},250)}}))}scareLoop(){try{const t=Object(i.i)({isAttackingUs:!0,isRIP:!1,isMonster:!0});let e=!1;if(t.length>=4)e=!0;else if(t.length&&!this.targetPriority[t[0].mtype])e=!0;else if(t.length&&parent.character.c.town)e=!0;else for(const r of t)if(!(distance(r,parent.character)>r.range||6*Object(i.b)(r,parent.character)[1]*r.frequency<=parent.character.hp)){e=!0;break}if(!Object(i.n)("scare")||!e)return void setTimeout(()=>{this.scareLoop()},Object(i.f)("scare"));if("jacko"==parent.character.slots.orb.name)use_skill("scare"),reduce_cooldown("scare",Math.min(...parent.pings));else{const t=Object(i.d)("jacko");if(t.length){const e=t[0].index;equip(e),use_skill("scare"),reduce_cooldown("scare",Math.min(...parent.pings))}}}catch(t){console.error(t)}setTimeout(()=>{this.scareLoop()},Object(i.f)("scare"))}agitateLoop(){try{if(Object(i.n)("agitate")){let t=0,e=0;for(const r in parent.entities){const n=parent.entities[r];if("monster"==n.type&&(!n.rip&&(!n.target||parent.party_list.includes(n.target))&&!(distance(parent.character,n)>G.skills.agitate.range))){if(!this.targetPriority[n.mtype]){t=10,e=9999;break}t++,e+=Object(i.b)(n,parent.character)[1]}}t>0&&t<=3&&e<1e3&&(use_skill("agitate"),reduce_cooldown("agitate",Math.min(...parent.pings)))}}catch(t){console.error(t)}setTimeout(()=>{this.agitateLoop()},Object(i.f)("agitate"))}warcryLoop(){if(Object(i.n)("warcry")){let t=0;for(const e of parent.party_list){const r=parent.entities[e];if(r&&("merchant"!=r.ctype&&(distance(parent.character,r)<G.skills.warcry.range&&(t+=1),2==t))){use_skill("warcry"),reduce_cooldown("warcry",Math.min(...parent.pings));break}}}setTimeout(()=>{this.warcryLoop()},Object(i.f)("warcry"))}stompLoop(){const t=Object(i.i)({isAttackingUs:!0,isRIP:!1});Object(i.n)("stomp")&&t.length&&t[0].hp>25e3&&distance(parent.character,t[0])<parent.character.range&&(use_skill("stomp"),reduce_cooldown("stomp",Math.min(...parent.pings))),setTimeout(()=>{this.stompLoop()},Object(i.f)("stomp"))}cleaveLoop(){const t=[],e=[];for(const r of Object(i.i)({isMonster:!0,isRIP:!1,isWithinDistance:G.skills.cleave.range}))parent.character.attack<Object(i.b)(parent.character,r)[0]?e.push(r):this.targetPriority[r.mtype]?this.wantToAttack(r,"cleave")&&t.push(r):e.push(r);let r=0;for(const t of e)r+=Object(i.b)(t,parent.character)[1];Object(i.n)("cleave")&&t.length>3&&r<1e3&&(use_skill("cleave"),reduce_cooldown("cleave",Math.min(...parent.pings))),setTimeout(()=>{this.cleaveLoop()},Object(i.f)("cleave"))}chargeLoop(){Object(i.n)("charge")&&use_skill("charge"),setTimeout(()=>{this.chargeLoop()},Object(i.f)("charge"))}hardshellLoop(){const t=Object(i.i)({isAttackingUs:!0,isRIP:!1});Object(i.n)("hardshell")&&t.length&&distance(t[0],parent.character)<=t[0].range&&parent.character.hp<5*Object(i.b)(t[0],parent.character)[1]&&(use_skill("hardshell"),reduce_cooldown("hardshell",Math.min(...parent.pings))),setTimeout(()=>{this.hardshellLoop()},Object(i.f)("hardshell"))}tauntLoop(){return o(this,void 0,void 0,(function*(){try{let t=0;const e=Object(i.i)({isAttackingUs:!0,isRIP:!1,isMonster:!0});for(const r of e)t+=Object(i.b)(r,parent.character)[1];if(t<1e3&&e.length<3){const e=Object(i.i)({isAttackingParty:!0,isAttackingUs:!1,isMonster:!0,isRIP:!1,isWithinDistance:G.skills.taunt.range});for(const r of e){if(!this.wantToAttack(r,"taunt"))continue;if(!(t+Object(i.b)(r,parent.character)[1]>1e3))return yield use_skill("taunt",r),reduce_cooldown("taunt",Math.min(...parent.pings)),void setTimeout(()=>{this.tauntLoop()},Object(i.f)("taunt"))}const r=Object(i.i)({isAttackingParty:!1,isMonster:!0,isRIP:!1,isWithinDistance:G.skills.taunt.range});for(const e of r){if(!this.wantToAttack(e,"taunt"))continue;if(!(t+Object(i.b)(e,parent.character)[1]>1e3)&&!(distance(parent.character,e)>parent.character.range&&e.range>4*parent.character.range))return yield use_skill("taunt",e),reduce_cooldown("taunt",Math.min(...parent.pings)),void setTimeout(()=>{this.tauntLoop()},Object(i.f)("taunt"))}}}catch(t){console.error(t)}setTimeout(()=>{this.tauntLoop()},Object(i.f)("taunt"))}))}}const c=new s}]);