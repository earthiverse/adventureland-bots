window.bots=function(t){var e={};function r(n){if(e[n])return e[n].exports;var a=e[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=9)}([function(t,e,r){"use strict";r.d(e,"q",(function(){return n})),r.d(e,"o",(function(){return a})),r.d(e,"i",(function(){return i})),r.d(e,"b",(function(){return s})),r.d(e,"c",(function(){return o})),r.d(e,"d",(function(){return c})),r.d(e,"a",(function(){return p})),r.d(e,"e",(function(){return h})),r.d(e,"n",(function(){return l})),r.d(e,"j",(function(){return m})),r.d(e,"g",(function(){return u})),r.d(e,"f",(function(){return f})),r.d(e,"m",(function(){return g})),r.d(e,"h",(function(){return d})),r.d(e,"l",(function(){return y})),r.d(e,"p",(function(){return v})),r.d(e,"k",(function(){return b}));function n(t){return new Promise(e=>setTimeout(e,t))}function a(t){return"character"==t.type&&!function(t){return!!t.npc}(t)}function i(t=parent.character.items){const e=[];for(let r=0;r<42;r++)t[r]&&e.push(Object.assign(Object.assign({},t[r]),{index:r}));return e}function s(t){for(let e=0;e<42;e++)if(parent.character.items[e]&&parent.character.items[e].name==t)return Object.assign(Object.assign({},parent.character.items[e]),{index:e})}function o(t){const e=[];for(let r=0;r<42;r++)parent.character.items[r]&&parent.character.items[r].name==t&&e.push(Object.assign(Object.assign({},parent.character.items[r]),{index:r}));return e}function c(t,e){const r=[];for(let n=0;n<42;n++)parent.character.items[n]&&parent.character.items[n].name==t&&parent.character.items[n].level==e&&r.push(Object.assign(Object.assign({},parent.character.items[n]),{index:n}));return r}function p(t,e){let r=t.attack;return t.apiercing||(t.apiercing=0),t.rpiercing||(t.rpiercing=0),e.armor||(e.armor=0),!t.damage_type&&t.slots.mainhand&&(t.damage_type=G.items[t.slots.mainhand.name].damage),e["1hp"]?[1,1]:("physical"==t.damage_type?r*=damage_multiplier(e.armor-t.apiercing):"magical"==t.damage_type&&(r*=damage_multiplier(e.resistance-t.rpiercing)),[.9*r,1.1*r])}function h(t){if(parent.next_skill&&parent.next_skill[t]){const e=parent.next_skill[t].getTime()-Date.now();return e<parent.character.ping?parent.character.ping:e}return parent.character.ping}function l(t=parent.character.items){for(let e=0;e<t.length;e++)if(!t[e])return!1;return!0}function m(){const t=new Set;for(const e of parent.party_list)t.add(parent.party[e].type);return t}function u(t=parent.character.items){const e=[];for(let r=0;r<t.length;r++)t[r]||e.push(r);return e}function f(){if("bank"!=parent.character.map)return;const t=[];for(const e in parent.character.bank)if("gold"!=e)for(let r=0;r<42;r++){parent.character.bank[e][r]||t.push({pack:e,index:r})}return t}function g(t){const e=G.skills[t].level;if(e&&e>parent.character.level)return!1;if(parent.character.stoned)return!1;if(parent.character.rip)return!1;const r=G.skills[t].wtype;if(r&&r!=G.items[parent.character.slots.mainhand.name].wtype)return!1;if(G.skills[t].slot)for(const e of G.skills[t].slot)if(parent.character.slots[e[0]].name!=e[1])return!1;if(G.skills[t].class){let e=!1;for(const r of G.skills[t].class)if(r==parent.character.ctype){e=!0;break}if(!e)return!1}let n=0;if(G.skills[t].mp?n=G.skills[t].mp:["attack","heal"].includes(t)&&(n=parent.character.mp_cost),parent.character.mp<n)return!1;if(void 0===parent.next_skill[t])return!0;const a=G.skills[t].share;return a?!parent.next_skill[a]||Date.now()>=parent.next_skill[a].getTime():Date.now()>=parent.next_skill[t].getTime()}function d({canAttackUsWithoutMoving:t,canMoveTo:e,isAttacking:r,isAttackingParty:n,isAttackingUs:a,isCtype:i,isMonster:s,isMonsterType:o,isMoving:c,isNPC:p,isPartyMember:h,isPlayer:l,isRIP:m,isWithinDistance:u}){const f=[],g=is_pvp();for(const d in parent.entities){const y=parent.entities[d],v=distance(parent.character,y);!0===t&&y.range>v||(!0!==e||can_move_to(y.real_x,y.real_y))&&(!1===e&&can_move_to(y.real_x,y.real_y)||(!0!==r||"monster"!=y.type||y.target)&&(!1===r&&"monster"==y.type&&y.target||(!0!==r||"character"!=y.type||y.target)&&(!0!==n||"monster"!=y.type||parent.party_list.includes(y.target))&&(!1===n&&"monster"==y.type&&parent.party_list.includes(y.target)||(!0!==n||"character"!=y.type||g)&&(!0===n&&"character"==y.type&&parent.party_list.includes(d)||!0===n&&"Wizard"==parent.character.name||!0===a&&"monster"==y.type&&y.target!=parent.character.name||!1===a&&"monster"==y.type&&y.target==parent.character.name||(!0!==a||"character"!=y.type||g)&&(!0===a&&"character"==y.type&&parent.party_list.includes(d)||!0===a&&"Wizard"==parent.character.name||(void 0===i||y.ctype)&&(void 0!==i&&y.ctype!=i||!0===s&&"monster"!=y.type||!1===s&&"monster"==y.type||(void 0===o||y.mtype)&&(void 0!==o&&y.mtype!=o||(!0!==c||y.moving)&&(!1===c&&y.moving||!0===p&&"character"!=y.type||(!0!==p||"character"!=y.type||y.npc)&&(!0!==h||parent.party_list.includes(d))&&(!1===h&&parent.party_list.includes(d)||!0===l&&"character"!=y.type||!0===l&&y.npc||(!0!==m||y.rip)&&(!1===m&&y.rip||void 0!==u&&v>u||f.push(y)))))))))))}return f}function y(){const t=new Set;for(const e in parent.entities){const r=parent.entities[e];r.mtype&&t.add(r.mtype)}return t}function v(t,e){for(const r of t)send_local_cm(r,e)}function _(t){const e=[];for(const r in G.maps){const n=G.maps[r];if(!n.instance)for(const a of n.monsters||[])if(a.type==t)if(a.boundary)e.push({map:r,x:(a.boundary[0]+a.boundary[2])/2,y:(a.boundary[1]+a.boundary[3])/2});else if(a.boundaries)for(const t of a.boundaries)e.push({map:t[0],x:(t[1]+t[3])/2,y:(t[2]+t[4])/2})}return e}function b(t){const e=_(t);return e[Math.floor(Math.random()*e.length)]}},function(t,e,r){"use strict";r.d(e,"h",(function(){return i})),r.d(e,"g",(function(){return s})),r.d(e,"d",(function(){return o})),r.d(e,"a",(function(){return c})),r.d(e,"j",(function(){return p})),r.d(e,"i",(function(){return h})),r.d(e,"e",(function(){return l})),r.d(e,"f",(function(){return m})),r.d(e,"b",(function(){return u})),r.d(e,"c",(function(){return f}));var n=r(0),a=function(t,e,r,n){return new(r||(r=Promise))((function(a,i){function s(t){try{c(n.next(t))}catch(t){i(t)}}function o(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,o)}c((n=n.apply(t,e||[])).next())}))};function i(t){if("bank"==parent.character.map)return;if(!Object(n.c)("computer").length){let t=!1;if(!G.maps[parent.character.map].npcs)return;for(const e of G.maps[parent.character.map].npcs.filter(t=>"merchant"==G.npcs[t.id].role))if(distance(parent.character,{x:e.position[0],y:e.position[1]})<350){t=!0;break}if(!t)return}const e=Object.keys(t);for(const r of Object(n.i)())if(e.includes(r.name)){if(r.level&&r.level>t[r.name])continue;r.q?sell(r.index,r.q):sell(r.index,1)}}function s(){const t=Object(n.b)("stand0");t&&void 0===parent.character.standed&&parent.open_merchant(t.index)}function o(){void 0!==parent.character.standed&&parent.close_merchant()}function c(t){let e=!1;for(const t of parent.npcs)if("secondhands"==t.id&&distance(parent.character,{x:t.position[0],y:t.position[1]})<350){e=!0;break}if(!e)return;let r=0;parent.socket.once("secondhands",e=>{for(let n=0;n<e.length&&!(t.has(e[n].name)&&(parent.socket.emit("sbuy",{rid:e[n].rid}),r++,r>=5));n++);}),parent.socket.emit("secondhands")}function p(t,e){const r=parent.entities[t];if(!r)return;if(distance(parent.character,r)>250)return;const n=new Set(e);for(let e=0;e<parent.character.items.length;e++){const r=parent.character.items[e];r&&(n.has(r.name)?n.delete(r.name):r.q?send_item(t,e,r.q):send_item(t,e,1))}}function h(t,e=0){if(parent.character.gold<=e)return;const r=parent.entities[t];r&&(distance(parent.character,r)>250||send_gold(t,parent.character.gold-e))}function l(t){return a(this,void 0,void 0,(function*(){if("bank"!=parent.character.map){if(!Object(n.c)("computer").length){let t=!1;for(const e of parent.npcs)if("craftsman"==e.id&&distance(parent.character,{x:e.position[0],y:e.position[1]})<250){t=!0;break}if(!t)return}for(const e in t)if(!(parent.character.gold<G.dismantle[e].cost))for(let r=t[e];r>0;r--){const t=Object(n.d)(e,r);for(const e of t)parent.socket.emit("dismantle",{num:e.index}),yield Object(n.q)(parent.character.ping)}}}))}function m(t){if(parent.character.q.exchange)return;if("bank"==parent.character.map)return;const e=Object(n.c)("computer").length,r=[];for(const t of parent.npcs)t.position&&distance(parent.character,{x:t.position[0],y:t.position[1]})<250&&r.push(t.id);if(!r.length&&!e)return;const a={};for(const t of Object(n.i)()){const e=G.items[t.name],r=e.e;if(!r||r>t.q)continue;let n;if(e.quest)n=G.quests[e.quest].id;else if("box"==e.type||"gem"==e.type||"misc"==e.type)n="exchange";else{if("lostearring"!=t.name||2!=t.level)continue;n="pwincess"}a[n]||(a[n]=[]),a[n].push(t)}for(const t in a){if(!r.includes(t)&&!e)continue;const n=a[t][0];return void exchange(n.index)}}function u(){return a(this,void 0,void 0,(function*(){if("bank"==parent.character.map)return;if(!Object(n.c)("computer").length){let t=!1;if(!G.maps[parent.character.map].npcs)return;for(const e of G.maps[parent.character.map].npcs.filter(t=>"fancypots"==t.id))if(distance(parent.character,{x:e.position[0],y:e.position[1]})<350){t=!0;break}if(!t)return}if(parent.character.gold<G.items.mpot1.g)return;const t={mpot1:9999,hpot1:9999};for(const e in t){const r=t[e],a=Object(n.c)(e).reduce((t,e)=>t+e.q,0);a<r&&(yield buy_with_gold(e,Math.min(r-a,parent.character.gold/G.items[e].g)))}}))}function f(){return a(this,void 0,void 0,(function*(){if("bank"==parent.character.map)return;if(!Object(n.c)("computer").length){let t=!1;if(!G.maps[parent.character.map].npcs)return;for(const e of G.maps[parent.character.map].npcs.filter(t=>"scrolls"==t.id))if(distance(parent.character,{x:e.position[0],y:e.position[1]})<350){t=!0;break}if(!t)return}if(parent.character.gold<G.items.scroll0.g)return;const t={scroll0:1e3,scroll1:100,scroll2:10,cscroll0:1e3,cscroll1:100,cscroll2:10};for(const e in t){const r=t[e],a=Object(n.c)(e).reduce((t,e)=>t+e.q,0),i=Math.min(r-a,Math.floor(parent.character.gold/G.items[e].g));a<r&&i>0&&(yield buy_with_gold(e,i))}}))}},function(t,e,r){"use strict";(function(t){var e=function(t,e){return t<e};function n(t){if(!(this instanceof n))return new n(t);this.array=[],this.size=0,this.compare=t||e}n.prototype.clone=function(){var t=new n(this.compare);t.size=this.size;for(var e=0;e<this.size;e++)t.array.push(this.array[e]);return t},n.prototype.add=function(t){var e,r,n=this.size;for(this.array[this.size]=t,this.size+=1;n>0&&(e=n-1>>1,r=this.array[e],this.compare(t,r));)this.array[n]=r,n=e;this.array[n]=t},n.prototype.heapify=function(t){var e;for(this.array=t,this.size=t.length,e=this.size>>1;e>=0;e--)this._percolateDown(e)},n.prototype._percolateUp=function(t,e){for(var r,n,a=this.array[t];t>0&&(r=t-1>>1,n=this.array[r],e||this.compare(a,n));)this.array[t]=n,t=r;this.array[t]=a},n.prototype._percolateDown=function(t){for(var e,r,n,a=this.size,i=this.size>>>1,s=this.array[t];t<i&&(r=(e=1+(t<<1))+1,n=this.array[e],r<a&&this.compare(this.array[r],n)&&(e=r,n=this.array[r]),this.compare(n,s));)this.array[t]=n,t=e;this.array[t]=s},n.prototype._removeAt=function(t){if(!(t>this.size-1||t<0))return this._percolateUp(t,!0),this.poll()},n.prototype.remove=function(t){for(var e=0;e<this.size;e++)if(!this.compare(this.array[e],t)&&!this.compare(t,this.array[e]))return this._removeAt(e),!0;return!1},n.prototype._batchRemove=function(t,e){var r=new Array(e||this.size),n=0;if("function"==typeof t&&this.size)for(var a=0;a<this.size&&n<r.length;)t(this.array[a])?(r[n]=this._removeAt(a),n++,a>>=1):a++;return r.length=n,r},n.prototype.removeOne=function(t){var e=this._batchRemove(t,1);return e.length>0?e[0]:void 0},n.prototype.removeMany=function(t,e){return this._batchRemove(t,e)},n.prototype.peek=function(){if(0!=this.size)return this.array[0]},n.prototype.poll=function(){if(0!=this.size){var t=this.array[0];return this.size>1?(this.array[0]=this.array[--this.size],this._percolateDown(0)):this.size-=1,t}},n.prototype.replaceTop=function(t){if(0!=this.size){var e=this.array[0];return this.array[0]=t,this._percolateDown(0),e}},n.prototype.trim=function(){this.array=this.array.slice(0,this.size)},n.prototype.isEmpty=function(){return 0===this.size},n.prototype.forEach=function(t){if(!this.isEmpty()&&"function"==typeof t)for(var e=0,r=this.clone();!r.isEmpty();)t(r.poll(),e++)},n.prototype.kSmallest=function(t){if(0==this.size)return[];var e=this.compare,r=this.array,a=new n((function(t,n){return e(r[t],r[n])}));t=Math.min(this.size,t);var i=new Array(t),s=0;for(a.add(0);s<t;){var o=a.poll();i[s++]=this.array[o];var c=1+(o<<1),p=c+1;c<this.size&&a.add(c),p<this.size&&a.add(p)}return i};r.c[r.s]===t&&function(){var t=new n((function(t,e){return t<e}));for(t.add(1),t.add(0),t.add(5),t.add(4),t.add(3);!t.isEmpty();)console.log(t.poll())}(),t.exports=n}).call(this,r(4)(t))},function(t,e,r){"use strict";var n=r(2),a=r.n(n),i=r(0),s=r(1),o=function(t,e,r,n){return new(r||(r=Promise))((function(a,i){function s(t){try{c(n.next(t))}catch(t){i(t)}}function o(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,o)}c((n=n.apply(t,e||[])).next())}))};class c{constructor(){this.TOWN_MOVEMENT_COST=200,this.DOOR_TOLERANCE=38,this.TELEPORT_TOLERANCE=73,this.MOVE_TOLERANCE=1,this.TOWN_TOLERANCE=1,this.FINISH_CHECK_DISTANCE=200,this.MOVEMENTS=[[[0,25],[0,5]],[[25,0],[5,0]],[[0,-25],[0,-5]],[[-25,0],[-5,0]]],this.USE_BLINK=!0,this.MOVE_ON_FAIL=!1,this.SHOW_MESSAGES=!1,this.MESSAGE_COLOR="#F7600E",this.doorCache=new Map}isMoving(){return null==this.finishedDate&&null!=this.startDate}wasCancelled(t){return!this.startDate||t<this.startDate}stop(){this.reset(),stop()}reset(){this.finishedDate=void 0,this.startDate=void 0}cleanPosition(t){const e=void 0!==t.real_x?t.real_x:t.x,r=void 0!==t.real_y?t.real_y:t.y;return{map:t.map,x:e,y:r,key:`${t.map}.${e}.${r}`,transportS:t.transportS,transportMap:t.transportMap,transportType:t.transportType}}positionToString(t){return`${t.map}.${t.x}.${t.y}`}stringToPosition(t){const e=t.split("."),r=e[0],n=Number.parseFloat(e[1]),a=Number.parseFloat(e[2]);return{map:r,x:n,real_x:n,y:a,real_y:a}}findDoorPath(t,e,r=new Set,n=new Set){if(r.add(t),t.map==e.map){const n=distance(t,e),a=[];for(const t of r)a.push(t);return a.push(e),[n,a]}const a=[...G.maps[t.map].doors];for(const e of G.maps[t.map].npcs)if("transporter"===e.id){for(const r in G.npcs.transporter.places)r!=t.map&&a.push([e.position[0],e.position[1],-1,-1,r,G.npcs.transporter.places[r]]);break}let i,s=Number.MAX_VALUE;for(const o of a){const a=o[4];if(n.has(a))continue;const c={map:t.map,x:o[0],y:o[1],key:`${t.map}.${o[0]}.${o[1]}`,transportS:o[5],transportMap:a,transportType:-1==o[3]?"teleport":"door"},p={map:a,x:G.maps[a].spawns[o[5]][0],y:G.maps[a].spawns[o[5]][1],key:`${a}.${G.maps[a].spawns[o[5]][0]}.${G.maps[a].spawns[o[5]][1]}`},h=new Set(n);h.add(a);const l=new Set(r);l.add(c);const m=distance(t,c)+50;if(s<m)continue;const[u,f]=this.findDoorPath(p,e,l,h);s>u+m&&(s=u+m,i=f)}return[s,i]}heuristic(t,e){return distance(t,e)}smoothPath(t){let e=[];e.push(t[0]);for(let r=0;r<t.length-1;r++){const n=t[r];if("town"==n.transportType){e.push(n);break}let a=r+1;for(let e=r+1;e<t.length;e++){const i=t[e];can_move({map:n.map,x:i.x,y:i.y,going_x:n.x,going_y:n.y,base:parent.character.base})&&(a=e,r=e-1)}a>0&&e.push(t[a])}return e=e.reverse(),e}reconstructPath(t,e,r){const n=[];for(n.push({map:e.map,x:e.x,real_x:e.x,y:e.y,real_y:e.y,key:`${e.map}.${e.x}.${e.y}`,transportMap:e.transportMap,transportType:e.transportType,transportS:e.transportS});t;)n.push({map:t.map,x:t.x,real_x:t.x,y:t.y,real_y:t.y,key:`${t.map}.${t.x}.${t.y}`,transportMap:t.transportMap,transportType:t.transportType,transportS:t.transportS}),t=r.get(t.key);return this.smoothPath(n)}smartMove(t,e=0){return o(this,void 0,void 0,(function*(){this.reset(),this.startDate=new Date;let r=[];const n=Date.now();this.SHOW_MESSAGES&&game_log("a* - start searching",this.MESSAGE_COLOR);const a=this.findDoorPath(this.cleanPosition(parent.character),this.cleanPosition(t))[1];for(let t=0;t<a.length;t+=2){const n=a[t],i=a[t+1],s=`${n.key}_${i.key}`;let o;this.doorCache.has(s)?o=this.doorCache.get(s):(o="door"==i.transportType?yield this.getMovements(n,i,this.DOOR_TOLERANCE):"teleport"==i.transportType?yield this.getMovements(n,i,this.TELEPORT_TOLERANCE):yield this.getMovements(n,i,e),this.doorCache.set(s,o)),r=r.concat(o)}this.SHOW_MESSAGES&&game_log(`a* - finish searching (${((Date.now()-n)/1e3).toFixed(1)} s)`,this.MESSAGE_COLOR);let i=0;const s=new Promise((t,e)=>{const n=a=>{if(this.wasCancelled(a))return stop(),e("a* - cancelled moving");const s=r[i];if(distance(parent.character,r[r.length-1])<this.MOVE_TOLERANCE)return this.SHOW_MESSAGES&&game_log("a* - done moving",this.MESSAGE_COLOR),this.finishedDate=new Date,void t();if(parent.character.moving||is_transporting(parent.character)||!can_walk(parent.character));else{if(s.map==parent.character.map&&this.USE_BLINK&&can_use("blink")&&distance(parent.character,s)>this.TOWN_MOVEMENT_COST&&parent.character.mp>G.skills.blink.mp){let t=i;for(;t<r.length&&r[t].map===parent.character.map;t++);return i=t-1,setTimeout(()=>{n(a)},900),void use_skill("blink",[r[i].x,r[i].y])}if(s.map==parent.character.map&&"town"==s.transportType)return distance(parent.character,s)<this.TOWN_TOLERANCE?(i+=1,void n(a)):(setTimeout(()=>{n(a)},900),void use_skill("town"));if(parent.character.map!=s.map||!can_move_to(s.x,s.y)){if(this.SHOW_MESSAGES&&game_log("a* - failed moving",this.MESSAGE_COLOR),this.MOVE_ON_FAIL){const t=2*Math.random()-1,e=2*Math.random()-1;move(parent.character.real_x+t,parent.character.real_y+e)}return this.reset(),e("failed moving")}if(distance(parent.character,s)<this.MOVE_TOLERANCE){if("door"!=s.transportType&&"teleport"!=s.transportType)return i+=1,void n(a);if(parent.character.map==s.map)return transport(s.transportMap,s.transportS),i+=1,void setTimeout(()=>{n(a)},100)}else move(s.x,s.y)}setTimeout(()=>{n(a)},40)};this.SHOW_MESSAGES&&game_log("a* - start moving",this.MESSAGE_COLOR),n(this.startDate)});return yield s}))}getMovements(t,e,r=0,n=this.startDate){return o(this,void 0,void 0,(function*(){const s=this.cleanPosition(t),o=this.cleanPosition(e),c=new Map,p=new Map;p.set(s.key,0);const h=new Map;h.set(s.key,this.heuristic(s,o));const l=new a.a((t,e)=>h.get(t.key)<h.get(e.key));l.add(Object.assign({},s));const m=new Set,u=this.cleanPosition({map:s.map,x:G.maps[s.map].spawns[0][0],y:G.maps[s.map].spawns[0][1],transportType:"town"}),f=p.get(s.key)+this.TOWN_MOVEMENT_COST;u.key!==s.key&&(!p.get(u.key)||f<p.get(u.key))&&(c.set(u.key,s),p.set(u.key,f),h.set(u.key,f+this.heuristic(u,o)),m.has(u.key)||(m.add(u.key),l.add(u)));let g=Date.now();for(;l.size;){const t=l.poll();m.delete(t.key);const e=distance(t,o);if(e<r){const e=this.reconstructPath(t,Object.assign(Object.assign({},t),{transportType:o.transportType,transportMap:o.transportMap,transportS:o.transportS}),c);return Promise.resolve(e)}if(e<r+this.FINISH_CHECK_DISTANCE)if(0==r){if(can_move({map:t.map,x:t.x,y:t.y,going_x:o.x,going_y:o.y,base:parent.character.base})){const e=this.reconstructPath(t,o,c);return Promise.resolve(e)}}else{const e=Math.atan2(t.y-o.y,t.x-o.x),n=o.x+Math.cos(e)*r,a=o.y+Math.sin(e)*r,i={map:o.map,x:n,y:a,key:this.positionToString({x:n,y:a,map:o.map}),transportMap:o.transportMap,transportType:o.transportType,transportS:o.transportS};if(can_move({map:t.map,x:t.x,y:t.y,going_x:i.x,going_y:i.y,base:parent.character.base})){const e=this.reconstructPath(t,i,c);return Promise.resolve(e)}}for(const e of this.MOVEMENTS)for(const r of e){const e=this.cleanPosition({map:t.map,x:Math.trunc(t.x+r[0]),y:Math.trunc(t.y+r[1])});if(can_move({map:t.map,x:t.x,y:t.y,going_x:e.x,going_y:e.y,base:parent.character.base})){const n=p.get(t.key)+Math.abs(r[0])+Math.abs(r[1]);(!p.has(e.key)||n<p.get(e.key))&&(c.set(e.key,t),p.set(e.key,n),h.set(e.key,n+this.heuristic(e,o)),m.has(e.key)||(m.add(e.key),l.add(e)))}}if(Date.now()-g>1e3&&(yield Object(i.q)(1),g=Date.now(),this.wasCancelled(n)))return Promise.reject("cancelled")}this.SHOW_MESSAGES&&game_log("a* - failed searching",this.MESSAGE_COLOR);try{let t,e=Number.MAX_VALUE;for(const[r,n]of h){const a=p.get(r);n-a<e&&(e=n-a,t=r)}const r=this.stringToPosition(t),n=this.reconstructPath(r,o,c);return Promise.resolve(n)}catch(t){return Promise.reject("Failed to find a path...")}}))}}r.d(e,"a",(function(){return h}));var p=function(t,e,r,n){return new(r||(r=Promise))((function(a,i){function s(t){try{c(n.next(t))}catch(t){i(t)}}function o(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,o)}c((n=n.apply(t,e||[])).next())}))};class h{constructor(){this.astar=new c,this.itemsToKeep=["computer","tracker","goldbooster","luckbooster","xpbooster","hpot1","mpot1","hotchocolate","candypop","jacko","lantern"],this.itemsToSell={shoes:2,pants:2,coat:2,helmet:2,gloves:2,cclaw:2,hpamulet:1,hpbelt:1,maceofthedead:2,ringsj:1,slimestaff:2,spear:2,throwingstars:2,vitearring:1,vitring:1},this.itemsToDismantle={},this.itemsToExchange=new Set(["5bucks","gem0","gem1","seashell","leather","candycane","mistletoe","ornament","candy0","candy1","redenvelopev3","basketofeggs","armorbox","weaponbox","xbox"]),this.itemsToBuy=new Set([...this.itemsToExchange,"ctristone","dexring","intring","ringofluck","strring","suckerpunch","tristone","lostearring","t2dexamulet","t2intamulet","t2stramulet","jacko","talkingskull","t2quiver","lantern","mshield","xshield","angelwings","bcape","cape","ecape","stealthcape","eslippers","mrnboots","mwboots","xboots","mrnpants","mwpants","starkillers","xpants","cdragon","mrnarmor","mwarmor","xarmor","eears","fury","mrnhat","mwhelmet","partyhat","rednose","xhelmet","goldenpowerglove","handofmidas","mrngloves","mwgloves","poker","powerglove","xgloves","basher","bowofthedead","candycanesword","dartgun","firebow","gbow","harbringer","hbow","merry","oozingterror","ornamentstaff","pmace","t2bow","ascale","bfur","cscale","fireblade","goldenegg","goldingot","goldnugget","leather","networkcard","platinumingot","platinumnugget","pleather","snakefang","x0","x1","x2","x3","x4","x5","x6","x7","x8","egg0","egg1","egg2","egg3","egg4","egg5","egg6","egg7","egg8","essenceofether","essenceoffire","essenceoffrost","essenceoflife","essenceofnature","goldbooster","luckbooster","xpbooster","candypop","elixirdex0","elixirdex1","elixirdex2","elixirint0","elixirint1","elixirint2","elixirluck","elixirstr0","elixirstr1","elixirstr2","greenbomb","hotchocolate","bottleofxp","bugbountybox","monstertoken","poison"]),this.holdPosition=!1,this.holdAttack=!1,this.info={party:{},npcs:{},players:{},monsters:{}}}mainLoop(){return p(this,void 0,void 0,(function*(){try{if("merchant"!=parent.character.ctype&&(this.equipBetterItems(),this.getMonsterhuntQuest(),yield Object(s.b)()),this.getNewYearTreeBuff(),Object(s.e)(this.itemsToDismantle),null==parent.character.slots.elixir){const t=Object(i.c)("candypop");t.length&&equip(t[0].index)}for(const t of Object(i.h)({isCtype:"merchant",isWithinDistance:400}))for(const e in t.slots){const r=t.slots[e];r&&(r.giveaway&&(r.list.includes(parent.character.id)||parent.socket.emit("join_giveaway",{slot:e,id:t.id,rid:r.rid})))}this.loot()}catch(t){console.error(t)}setTimeout(()=>{this.mainLoop()},Math.max(250,parent.character.ping))}))}run(){this.healLoop(),this.attackLoop(),this.scareLoop(),this.moveLoop2(),this.sendInfoLoop(),this.mainLoop()}sendInfoLoop(){try{let t;t={message:"info",info:{lastSeen:new Date,shouldSwitchServer:this.shouldSwitchServer(),monsterHuntTargets:this.getMonsterHuntTargets(),items:Object(i.i)(),attack:parent.character.attack,frequency:parent.character.frequency,goldm:parent.character.goldm,last_ms:parent.character.last_ms,luckm:parent.character.luckm,map:parent.character.map,x:parent.character.real_x,y:parent.character.real_y,s:parent.character.s}},Object(i.p)(parent.party_list,t),this.parseCM(parent.character.name,t);for(const e of Object(i.h)({isPlayer:!0}))t={message:"player",id:e.id,info:{lastSeen:new Date,rip:e.rip,map:e.map,x:e.real_x,y:e.real_y,s:e.s,ctype:e.ctype}},Object(i.p)(parent.party_list,t),this.parseCM(parent.character.name,t);for(const e of["Angel","Kane"])parent.entities[e]&&(t={message:"npc",id:e,info:{lastSeen:new Date,map:parent.entities[e].map,x:parent.entities[e].real_x,y:parent.entities[e].real_y}},parent.entities[e]&&(Object(i.p)(parent.party_list,t),this.parseCM(parent.character.name,t)))}catch(t){console.error(t)}setTimeout(()=>{this.sendInfoLoop()},5e3)}getMonsterHuntTargets(){const t=[];let e=Number.MAX_VALUE;for(const r of parent.party_list){const n=this.info.party[r];if(!n)continue;if(!n.s.monsterhunt||0==n.s.monsterhunt.c)continue;if(!this.targetPriority[n.s.monsterhunt.id])continue;const a=this.targetPriority[n.s.monsterhunt.id].coop;if(a){const t=Object(i.j)();if(a.filter(e=>!t.has(e)).length)continue}const s=n.s.monsterhunt.ms-(Date.now()-new Date(n.last_ms).getTime());s<e?(e=s,t.unshift(n.s.monsterhunt.id)):t.push(n.s.monsterhunt.id)}return t}shouldSwitchServer(){if("merchant"==parent.character.ctype)return!0;if(!parent.character.s.monsterhunt)return!1;if(0==parent.character.s.monsterhunt.c)return!1;if(this.getMonsterHuntTargets().length)return!1;for(const t in parent.S)if("grinch"!=t&&!(parent.S[t].hp/parent.S[t].max_hp>.9)&&parent.S[t].live&&this.targetPriority[t])return!1;return!0}loot(){let t=0;for(const e in parent.chests){const r=parent.chests[e];if(distance(parent.character,r)>800)continue;let n=!0;for(const t of parent.party_list){if(t==parent.character.id)continue;const e=parent.entities[t];if(e&&(!(distance(e,r)>800)&&this.info.party[t])){if(["chest3","chest4"].includes(r.skin)){if(parent.character.goldm>=this.info.party[t].goldm)continue}else if(parent.character.luckm>=this.info.party[t].luckm)continue;n=!1;break}}if(n&&(parent.socket.emit("open_chest",{id:e}),++t>10))break}}attackLoop(){return p(this,void 0,void 0,(function*(){try{const t=this.getTargets(1);t.length&&this.wantToAttack(t[0])&&(yield attack(t[0]))}catch(t){["cooldown","not_found","disabled"].includes(t.reason)||console.error(t)}setTimeout(()=>{this.attackLoop()},Object(i.e)("attack"))}))}scareLoop(){try{const t=Object(i.h)({isAttackingUs:!0,isMonster:!0,isRIP:!1});let e=!1;if(t.length>=3)e=!0;else if(t.length&&!this.targetPriority[t[0].mtype])e=!0;else if(parent.character.c.town&&(t.length>1||1==t.length&&distance(t[0],parent.character)-t[0].range-2*t[0].speed))e=!0;else for(const r of t)if(!(distance(r,parent.character)>r.range||6*Object(i.a)(r,parent.character)[1]*r.frequency<=parent.character.hp)){e=!0;break}if(!Object(i.m)("scare")||!e)return void setTimeout(()=>{this.scareLoop()},Object(i.e)("scare"));if("jacko"==parent.character.slots.orb.name)use_skill("scare");else{const t=Object(i.c)("jacko");if(t.length){const e=t[0].index;equip(e),use_skill("scare")}}}catch(t){console.error(t)}setTimeout(()=>{this.scareLoop()},Object(i.e)("scare"))}getMovementLocation(t){if(!this.targetPriority[t])return;if(this.targetPriority[t].farmingPosition&&this.targetPriority[t].holdPositionFarm)return this.targetPriority[t].farmingPosition;if(Object(i.l)().has(t))return;if(this.targetPriority[t].farmingPosition)return distance(parent.character,this.targetPriority[t].farmingPosition)<300?void 0:this.targetPriority[t].farmingPosition;if(parent.S[t]){if(!parent.S[t].live)return;return parent.S[t]}const e=Object(i.k)(t);return e||void 0}getMovementTarget(){if(parent.character.rip)return void set_message("RIP");if(parent.character.s.monsterhunt&&0==parent.character.s.monsterhunt.c)return set_message("Finish MH"),{target:"monsterhunter",position:G.maps.main.ref.monsterhunter,range:300};for(const t of Object(i.h)({isMonster:!0,isRIP:!1}))if(("goldenbat"==t.mtype||"phoenix"==t.mtype)&&this.targetPriority[t.mtype])return set_message(t.mtype),{target:t.mtype,position:t,range:parent.character.range};for(const t in this.info.monsters){if(!this.targetPriority[t])continue;const e=this.info.monsters[t],r=parent.entities[e.id];if(r&&(e.x=r.real_x,e.y=r.real_y),!(distance(parent.character,e)<100)||r)return set_message(`SP ${t}`),{target:t,position:e,range:0};delete this.info.monsters[t]}if(G.maps.main.ref.newyear_tree&&!parent.character.s.holidayspirit)return set_message("Xmas Tree"),{target:"newyear_tree",position:G.maps.main.ref.newyear_tree,range:300};if(Object(i.n)())return set_message("Full!"),{target:"merchant",position:{map:"main",x:60,y:-325},range:300};for(const t in parent.S)if(parent.S[t].live&&this.targetPriority[t])return set_message(t),{target:t,position:parent.S[t],range:parent.character.range};const t=this.getMonsterHuntTargets();if(t.length){const e=t[0],r=this.targetPriority[e].coop;if(!r)return set_message(`MH ${e}`),{target:e,position:this.getMovementLocation(e)};{const t=new Set;for(const r of parent.party_list)this.info.party[r]&&this.info.party[r].monsterHuntTargets&&this.info.party[r].monsterHuntTargets[0]==e&&t.add(parent.party[r].type);if(0==r.filter(e=>!t.has(e)).length)return set_message(`MH ${e}`),{target:e,position:this.getMovementLocation(e)}}}return parent.character.s.monsterhunt?this.mainTarget?(set_message(this.mainTarget),{target:this.mainTarget,position:this.getMovementLocation(this.mainTarget)}):void 0:(set_message("New MH"),{target:"monsterhunter",position:G.maps.main.ref.monsterhunter,range:300})}moveLoop2(){try{if(this.holdPosition||smart.moving)return void setTimeout(()=>{this.moveLoop2()},parent.character.ping);const t=this.movementTarget;if(this.movementTarget=this.getMovementTarget(),this.movementTarget&&this.movementTarget.position){if(!t||this.movementTarget.target!=t.target||t.position&&this.movementTarget.position.map!=t.position.map)return this.astar.stop(),this.astar.smartMove(this.movementTarget.position,this.movementTarget.range),void setTimeout(()=>{this.moveLoop2()},parent.character.ping);if(!this.astar.isMoving())return this.astar.smartMove(this.movementTarget.position,this.movementTarget.range),void setTimeout(()=>{this.moveLoop2()},parent.character.ping)}const e=this.getTargets(1);if(e.length&&e[0].mtype==this.movementTarget.target&&this.targetPriority[e[0].mtype]&&!this.targetPriority[e[0].mtype].holdPositionFarm&&this.astar.stop(),this.astar.isMoving())return void setTimeout(()=>{this.moveLoop2()},parent.character.ping);if(this.targetPriority[this.movementTarget.target]&&this.targetPriority[this.movementTarget.target].holdPositionFarm)return void setTimeout(()=>{this.moveLoop2()},parent.character.ping);const r=[],n=[],a=[],s=[],o=[],c=[],p=[],h=[];for(const t in parent.entities){const e=parent.entities[t];if(e.rip)continue;if(!this.targetPriority[e.mtype])continue;const l=distance(parent.character,e),m=Math.max(e.range+e.speed,50);m<parent.character.range&&l<m&&(e.hp>Object(i.a)(parent.character,e)[0]||e.target==parent.character.name)&&r.push(e),!e.target&&l<50&&n.push(e),l<parent.character.range&&(a.push(e),this.movementTarget.target==e.mtype&&s.push(e)),l<2*parent.character.range&&(o.push(e),this.movementTarget.target==e.mtype&&c.push(e)),p.push(e),this.movementTarget.target==e.mtype&&h.push(e)}if(0==s.length&&h.length>0){let t,e=Number.MAX_VALUE;for(const r of h){const n=distance(parent.character,r);n<e&&(e=n,t=r)}return this.astar.smartMove(t,parent.character.range),void setTimeout(()=>{this.moveLoop2()},parent.character.ping)}if(r.length){const t={x:0,y:0};let e=0;for(const n of r)t.x+=n.real_x,t.y+=n.real_y,n.range+n.speed>e&&(e=n.range+n.speed);t.x/=r.length,t.y/=r.length;distance(parent.character,t);const n=Math.atan2(parent.character.real_y-t.y,parent.character.real_x-t.x),a=Math.min(parent.character.range,1.5*e),i=(t,e)=>{const r=Math.cos(t)*e,n=Math.sin(t)*e;return{x:parent.character.real_x+r,y:parent.character.real_y+n}};let s=i(n,a),o=0;for(;!can_move_to(s.x,s.y)&&o<180;)o=o<=0?1-o:-o,s=i(n+o*Math.PI/180,a);return move(s.x,s.y),void setTimeout(()=>{this.moveLoop2()},parent.character.ping)}if(0==a.length&&0==o.length&&0!=p.length){let t,e=Number.MAX_VALUE;for(const r of p){const n=distance(parent.character,r);n<e&&(e=n,t=r)}return this.astar.smartMove(t,parent.character.range),void setTimeout(()=>{this.moveLoop2()},parent.character.ping)}if(0==a.length&&o.length>0){let t,e=Number.MAX_VALUE;for(const r of o){const n=distance(parent.character,r);n<e&&(e=n,t=r)}return this.astar.smartMove(t,parent.character.range),void setTimeout(()=>{this.moveLoop2()},parent.character.ping)}}catch(t){console.error(t)}setTimeout(()=>{this.moveLoop2()},parent.character.ping)}healLoop(){try{if(parent.character.rip)return respawn(),void setTimeout(()=>{this.healLoop()},Object(i.e)("use_town"));if(!Object(i.m)("use_hp"))return void setTimeout(()=>{this.healLoop()},Object(i.e)("use_hp"));const t=["hpot0","hpot1"],e=["mpot0","mpot1"];let r=null,n=null;for(let a=parent.character.items.length-1;a>=0;a--){const i=parent.character.items[a];if(i&&(!n&&t.includes(i.name)?n=i:!r&&e.includes(i.name)&&(r=i),n&&r))break}const a=parent.character.hp/parent.character.max_hp,s=parent.character.mp/parent.character.max_mp;a<=s&&1!=a&&(!n||"hpot0"==n.name&&(parent.character.hp<=parent.character.max_hp-200||parent.character.hp<50)||"hpot1"==n.name&&(parent.character.hp<=parent.character.max_hp-400||parent.character.hp<50))?use_skill("use_hp"):1!=s&&(!r||"mpot0"==r.name&&(parent.character.mp<=parent.character.max_mp-300||parent.character.mp<50)||"mpot1"==r.name&&(parent.character.mp<=parent.character.max_mp-500||parent.character.mp<50))?use_skill("use_mp"):a<s?parent.socket.emit("use",{item:"hp"}):s<a&&parent.socket.emit("use",{item:"mp"})}catch(t){console.error(t)}setTimeout(()=>{this.healLoop()},Math.max(250,Object(i.e)("use_hp")))}getNewYearTreeBuff(){G.maps.main.ref.newyear_tree&&(parent.character.s.holidayspirit||distance(parent.character,G.maps.main.ref.newyear_tree)>400||parent.socket.emit("interaction",{type:"newyear_tree"}))}getMonsterhuntQuest(){distance(parent.character,G.maps.main.ref.monsterhunter)>400||(parent.character.s.monsterhunt?0==parent.character.s.monsterhunt.c&&parent.socket.emit("monsterhunt"):parent.socket.emit("monsterhunt"))}parseCM(t,e){if(parent.party_list.includes(t)||parent.character.name==t||"monster"==e.message){if("info"==e.message)this.info.party[t]=e.info;else if("monster"==e.message)this.info.monsters[e.id]=e.info;else if("npc"==e.message)this.info.npcs[e.id]=e.info;else if("player"==e.message)this.info.players[e.id]=e.info;else if("chests"==e.message)for(const t in e.chests)parent.chests[t]||(parent.chests[t]=e.chests[t])}else game_log("Blocked CM from "+t)}equipBetterItems(){try{const t=Object(i.i)();if(this.movementTarget.target&&this.targetPriority[this.movementTarget.target])for(const e of this.targetPriority[this.movementTarget.target].equip||[]){let r=!1;for(const t in parent.character.slots){const n=parent.character.slots[t];if(n&&n.name==e){r=!0;break}}if(!r)for(const r of t)if(r.name==e){equip(r.index);break}}for(const e in parent.character.slots){let r,n=parent.character.slots[e];if(n){for(const e of t)e.name==n.name&&(!e.level||e.level<=n.level||(n=e,r=e));r&&equip(r.index,e)}}}catch(t){console.error(t)}}getTargets(t=1,e=parent.character.range){const r=[],n=parent.party_list,s=new Set;for(const t in parent.entities)if(n.includes(t)){const e=parent.entities[t].target;e&&s.add(e)}const o=new a.a((t,e)=>t.priority>e.priority);for(const t in parent.entities){const r=parent.entities[t];if(r.rip)continue;if(parent.party_list.includes(t))continue;if(!is_pvp()&&"monster"!=r.type)continue;if(is_pvp()&&parent.party_list.includes(t))continue;if(!this.targetPriority[r.mtype]&&r.target!=parent.character.name)continue;let n=this.targetPriority[r.mtype]?this.targetPriority[r.mtype].priority:0;const a=distance(parent.character,r);if(a>e)continue;n-=a,s.has(t)&&(this.targetPriority[r.mtype]&&this.targetPriority[r.mtype].coop&&(n+=parent.character.range),r.hp<=Object(i.a)(parent.character,r)[0]&&(n-=parent.character.range)),r.mtype==this.mainTarget&&(n+=250),this.movementTarget&&r.mtype==this.movementTarget.target&&(n+=1e3),r.target==parent.character.name&&(n+=2e3),r.cooperative&&(n+=1e3*(r.max_hp-r.hp)/r.max_hp);const c={id:r.id,priority:n};o.add(c)}for(;r.length<t&&o.size>0;){const t=parent.entities[o.poll().id];t&&r.push(t)}return r.length>0&&change_target(r[0],!0),r}wantToAttack(t,e="attack"){if(!Object(i.m)(e))return!1;if(parent.character.c.town)return!1;let r=G.skills[e].range?G.skills[e].range:parent.character.range;const n=distance(parent.character,t);if(G.skills[e].range_multiplier&&(r*=G.skills[e].range_multiplier),n>r)return!1;const a=G.skills[e].mp?G.skills[e].mp:parent.character.mp_cost;if(parent.character.mp<a)return!1;if("attack"!=e&&t.immune)return!1;if("attack"!=e&&t["1hp"])return!1;if(!is_pvp()&&"monster"==t.type&&!this.targetPriority[t.mtype])return!1;if(!t.target){if(this.holdAttack)return!1;if((smart.moving||this.astar.isMoving())&&this.targetPriority[t.mtype].holdAttackWhileMoving)return!1;if(this.targetPriority[t.mtype].holdAttackInEntityRange&&n<=t.range)return!1;if(this.targetPriority[t.mtype].coop){const e=[parent.character.ctype];for(const t of parent.party_list){const r=parent.entities[t];r&&(r.rip||"priest"==r.ctype&&distance(parent.character,r)>r.range||e.push(r.ctype))}for(const r of this.targetPriority[t.mtype].coop)if(!e.includes(r))return!1}if(5*Object(i.a)(t,parent.character)[1]*t.frequency>parent.character.hp&&n<=t.range)return!1}return!0}}},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},,,,,function(t,e,r){"use strict";r.r(e);var n=r(3),a=r(0);var i=r(1);r.d(e,"merchant",(function(){return c}));var s=function(t,e,r,n){return new(r||(r=Promise))((function(a,i){function s(t){try{c(n.next(t))}catch(t){i(t)}}function o(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,o)}c((n=n.apply(t,e||[])).next())}))};class o extends n.a{constructor(){super(),this.targetPriority={bee:{priority:1},crab:{priority:1},goo:{priority:1},hen:{priority:1},rooster:{priority:1},snowman:{priority:1}},this.mainTarget=null,this.didBankStuff=0,this.luckedCharacters={},this.itemsToKeep.push("cscroll0","cscroll1","cscroll2","scroll0","scroll1","scroll2","stand0","dexscroll","intscroll","strscroll","monstertoken","platinumnugget")}getMovementTarget(){if(parent.character.rip)return void set_message("RIP");if(G.maps.main.ref.newyear_tree&&!parent.character.s.holidayspirit)return set_message("Xmas Tree"),{target:"newyear_tree",position:G.maps.main.ref.newyear_tree,range:300};if(Object(a.n)())return set_message("Full!"),"bank"==parent.character.map?void 0:{target:"items4",position:{map:"bank",x:0,y:-400},range:10};for(const t in parent.S){const e=parent.S[t];if(e.live&&!(e.hp>e.max_hp/2))return set_message(t),{target:t,position:e,range:50}}for(const t of parent.party_list){if(t==parent.character.name)continue;const e=parent.entities[t]?parent.entities[t]:this.info.party[t];if(e&&e.s&&(!e.s.mluck||e.s.mluck.f!=parent.character.id))return set_message(`ML ${t}`),{position:e,range:G.skills.mluck.range-20}}for(const t in this.info.players){const e=parent.entities[t]?parent.entities[t]:this.info.players[t];if(distance(parent.character,e)<=G.skills.mluck.range&&(!e.s.mluck||Date.now()-new Date(this.info.players[t].lastSeen).getTime()>3e6||e.s.mluck.ms<18e5)){delete this.info.players[t];break}if((!e.s.mluck||Date.now()-new Date(this.info.players[t].lastSeen).getTime()>3e6||e.s.mluck.ms<18e5)&&!e.rip)return set_message(`ML ${t}`),{position:e,range:G.skills.mluck.range-20}}for(const t of parent.party_list){if(t==parent.character.name)continue;const e=this.info.party[t];if(e&&e.items.length>20)return set_message(`INV ${t}`),{position:e,range:240}}return Date.now()-this.didBankStuff>12e4?(set_message("Bank"),{position:{map:"bank",x:0,y:-400}}):this.info.npcs.Kane&&Date.now()-new Date(this.info.npcs.Kane.lastSeen).getTime()>3e5?(set_message("Find Kane"),{position:this.info.npcs.Kane}):this.info.npcs.Angel&&Date.now()-new Date(this.info.npcs.Angel.lastSeen).getTime()>3e5?(set_message("Find Angel"),{position:this.info.npcs.Angel}):(set_message("Vendor"),{position:{map:"main",x:60,y:-325}})}mainLoop(){const t=Object.create(null,{mainLoop:{get:()=>super.mainLoop}});return s(this,void 0,void 0,(function*(){try{Object(i.h)(this.itemsToSell);let e=0;for(let t=0;t<42;t++)parent.character.items[t]&&e++;e<25&&Object(i.f)(this.itemsToExchange),yield this.bankStuff(),parent.character.moving?Object(i.d)():Object(i.g)(),function(t){if("bank"!=parent.character.map&&!parent.character.q.upgrade){if(!Object(a.c)("computer").length){let t=!1;for(const e of parent.npcs)if("newupgrade"==e.id&&distance(parent.character,{x:e.position[0],y:e.position[1]})<350){t=!0;break}if(!t)return}for(let e=0;e<42;e++){if(!parent.character.items[e])continue;if(!G.items[parent.character.items[e].name].upgrade)continue;const r=Object(a.c)(parent.character.items[e].name);if(1==r.length)continue;r.sort((t,e)=>t.name>e.name||t.level>e.level?1:-1);const n=r[0];if(n.level>=t)continue;const i=item_grade(n);let s;return 0==i?s=Object(a.b)("scroll0"):1==i?s=Object(a.b)("scroll1"):2==i&&(s=Object(a.b)("scroll2")),void(s&&upgrade(n.index,s.index))}}}(8),function(t){if("bank"==parent.character.map)return;if(parent.character.q.compound)return;if(!Object(a.c)("computer").length){let t=!1;for(const e of parent.npcs)if("newupgrade"==e.id&&distance(parent.character,{x:e.position[0],y:e.position[1]})<350){t=!0;break}if(!t)return}const e=[];for(const r of Object(a.i)())G.items[r.name].compound&&(r.level>=t||e.push(r));e.sort((t,e)=>t.name>e.name||t.level>e.level?1:-1);for(let t=0;t<e.length-2;t++)if(e[t].name==e[t+1].name&&e[t].name==e[t+2].name&&e[t].level==e[t+1].level&&e[t].level==e[t+2].level){const r=item_grade(e[t]);let n;return 0==r?n=Object(a.b)("cscroll0"):1==r?n=Object(a.b)("cscroll1"):2==r&&(n=Object(a.b)("cscroll2")),void compound(e[t].index,e[t+1].index,e[t+2].index,n.index)}}(4),yield Object(i.c)(),t.mainLoop.call(this)}catch(t){console.error(t),setTimeout(()=>{this.mainLoop()},1e3)}}))}run(){this.attackLoop(),this.healLoop(),this.scareLoop(),this.moveLoop2(),this.sendInfoLoop(),this.mainLoop(),this.luckLoop(),this.pontyLoop()}pontyLoop(){let t=!1;for(const e of parent.npcs)if("secondhands"==e.id&&distance(parent.character,{x:e.position[0],y:e.position[1]})<350){t=!0;break}t?(Object(i.a)(this.itemsToBuy),setTimeout(()=>{this.pontyLoop()},15e3)):setTimeout(()=>{this.pontyLoop()},250)}bankStuff(){return s(this,void 0,void 0,(function*(){if("bank"!=parent.character.map)return;if(Date.now()-this.didBankStuff<3e4)return;parent.character.gold>1e8?bank_deposit(parent.character.gold-1e8):parent.character.gold<1e8&&bank_withdraw(1e8-parent.character.gold);const t=[];for(const t of Object(a.i)()){if(this.itemsToKeep.includes(t.name))continue;if(G.items[t.name].s){yield Object(a.q)(parent.character.ping),bank_store(t.index);continue}let e=0;const r=Object(a.f)()||[];e<r.length&&(yield Object(a.q)(parent.character.ping),bank_store(t.index,r[e].pack,r[e].index),e++)}for(const e in parent.character.bank)if("gold"!=e)for(const r of Object(a.i)(parent.character.bank[e]))["goldenegg","luckbooster","goldbooster","xpbooster"].includes(r.name)||(G.items[r.name].e&&r.q>=G.items[r.name].e?t.push([r.name,-1,e,r.index]):G.items[r.name].s||G.items[r.name].upgrade&&r.level>=8||G.items[r.name].compound&&r.level>=4||t.push([r.name,r.level,e,r.index]));const e=Object(a.g)(parent.character.items);e.pop(),t.sort();for(let r=0;r<t.length;r++){const n=t[r],i=[r];for(let e=r+1;e<t.length;e++){const a=t[e];if(a[0]!=n[0]||a[1]!=n[1]){r=e-1;break}i.push(e)}if(G.items[n[0]].compound&&i.length>=4)for(let r=0;r<3;r++){const n=i[r],s=t[n][2],o=t[n][3];yield Object(a.q)(parent.character.ping),e.length&&parent.socket.emit("bank",{operation:"swap",inv:e.shift(),str:o,pack:s})}}for(let r=0;r<t.length;r++){const n=t[r],i=[r];for(let e=r+1;e<t.length;e++){if(t[e][0]!=n[0]){r=e-1;break}i.push(e)}if(G.items[n[0]].upgrade&&i.length>=2)for(const r of i){const n=t[r][2],i=t[r][3];yield Object(a.q)(parent.character.ping),e.length&&parent.socket.emit("bank",{operation:"swap",inv:e.shift(),str:i,pack:n})}}for(let r=0;r<t.length;r++){if(!G.items[t[r][0]].e)continue;const n=t[r][2],i=t[r][3];yield Object(a.q)(parent.character.ping),e.length&&parent.socket.emit("bank",{operation:"swap",inv:e.shift(),str:i,pack:n})}for(let r=0;r<t.length;r++){if(!this.itemsToSell[t[r][0]]||t[r][1]>this.itemsToSell[t[r][0]])continue;const n=t[r][2],i=t[r][3];yield Object(a.q)(parent.character.ping),e.length&&parent.socket.emit("bank",{operation:"swap",inv:e.shift(),str:i,pack:n})}this.didBankStuff=Date.now()}))}luckLoop(){return s(this,void 0,void 0,(function*(){try{if(parent.character.mp<10)return void setTimeout(()=>{this.luckLoop()},Object(a.e)("mluck"));(!parent.character.s.mluck||parent.character.s.mluck.ms<1e4||parent.character.s.mluck.f!=parent.character.name)&&(use_skill("mluck",parent.character),yield Object(a.q)(G.skills.mluck.cooldown));for(const t in parent.entities){const e=parent.entities[t];!Object(a.o)(e)||distance(parent.character,e)>G.skills.mluck.range||!Object(a.m)("mluck")||(this.luckedCharacters[e.name]&&this.luckedCharacters[e.name]>Date.now()-2*parent.character.ping||(!e.s||!e.s.mluck||e.s.mluck.ms<354e4||e.s.mluck.f!=parent.character.name)&&(this.luckedCharacters[e.name]=Date.now(),use_skill("mluck",e),yield Object(a.q)(G.skills.mluck.cooldown)))}}catch(t){console.error(t),console.error(parent.entities)}setTimeout(()=>{this.luckLoop()},Object(a.e)("mluck"))}))}}const c=new o}]);